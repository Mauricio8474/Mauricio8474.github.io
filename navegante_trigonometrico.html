<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XZ1QWD1TCC"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XZ1QWD1TCC');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navegante Trigonom√©trico - Grado 10¬∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #74b9ff 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .ocean-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(116, 185, 255, 0.3) 0%, transparent 30%),
                radial-gradient(circle at 80% 60%, rgba(45, 152, 218, 0.4) 0%, transparent 40%),
                radial-gradient(circle at 40% 80%, rgba(74, 144, 226, 0.2) 0%, transparent 50%);
            animation: wave 20s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes wave {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(1deg); }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 10;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .header h1 {
            font-size: 3rem;
            background: linear-gradient(45deg, #00b894, #00cec9, #74b9ff);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(0, 184, 148, 0.5);
            margin-bottom: 10px;
            animation: compass 4s ease-in-out infinite;
        }

        @keyframes compass {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(0, 184, 148, 0.5)); }
            50% { filter: drop-shadow(0 0 40px rgba(116, 185, 255, 0.8)); }
        }

        .subtitle {
            font-size: 1.2rem;
            color: #ddd;
            margin-bottom: 20px;
        }

        .difficulty-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .difficulty-btn {
            background: linear-gradient(135deg, rgba(116, 185, 255, 0.2), rgba(9, 132, 227, 0.1));
            border: 2px solid rgba(116, 185, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .difficulty-btn.active {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            box-shadow: 0 0 20px rgba(116, 185, 255, 0.5);
        }

        .navigation-panel {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }

        .ship-status {
            background: linear-gradient(135deg, rgba(0, 184, 148, 0.2) 0%, rgba(0, 206, 201, 0.1) 100%);
            border: 2px solid rgba(0, 184, 148, 0.3);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(10px);
        }

        .ocean-map {
            background: linear-gradient(135deg, rgba(116, 185, 255, 0.2) 0%, rgba(45, 152, 218, 0.1) 100%);
            border: 2px solid rgba(116, 185, 255, 0.3);
            border-radius: 20px;
            padding: 25px;
            position: relative;
            overflow: hidden;
        }

        .compass-tools {
            background: linear-gradient(135deg, rgba(253, 203, 110, 0.2) 0%, rgba(255, 159, 67, 0.1) 100%);
            border: 2px solid rgba(253, 203, 110, 0.3);
            border-radius: 20px;
            padding: 25px;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            color: #74b9ff;
            text-shadow: 0 0 10px rgba(116, 185, 255, 0.5);
        }

        .ship-icon {
            font-size: 4rem;
            text-align: center;
            margin: 15px 0;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(-2deg); }
            50% { transform: translateY(-10px) rotate(2deg); }
        }

        .coordinate-display {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            text-align: center;
            font-family: 'Courier New', monospace;
        }

        .coordinate-value {
            font-size: 1.2rem;
            color: #00cec9;
            font-weight: bold;
        }

        .map-canvas {
            width: 100%;
            height: 300px;
            background: linear-gradient(135deg, #006ba6 0%, #0582ca 50%, #74b9ff 100%);
            border-radius: 15px;
            position: relative;
            border: 2px solid rgba(255, 255, 255, 0.2);
            overflow: hidden;
        }

        .ship-position {
            position: absolute;
            font-size: 2rem;
            transition: all 1s cubic-bezier(0.4, 0, 0.2, 1);
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.8));
            z-index: 10;
        }

        .treasure-position {
            position: absolute;
            font-size: 2rem;
            animation: treasure-glow 2s ease-in-out infinite;
            z-index: 5;
        }

        .ship-trail {
            position: absolute;
            width: 3px;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0.8), transparent);
            border-radius: 2px;
            z-index: 1;
        }

        @keyframes treasure-glow {
            0%, 100% { filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.8)) scale(1); }
            50% { filter: drop-shadow(0 0 20px rgba(255, 215, 0, 1)) scale(1.1); }
        }

        .compass {
            width: 120px;
            height: 120px;
            border: 4px solid #fdcb6e;
            border-radius: 50%;
            margin: 20px auto;
            position: relative;
            background: radial-gradient(circle, rgba(253, 203, 110, 0.3) 0%, rgba(255, 159, 67, 0.1) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .compass-needle {
            width: 80px;
            height: 4px;
            background: linear-gradient(90deg, #e17055, #fdcb6e);
            border-radius: 2px;
            position: absolute;
            transform-origin: center;
            transition: transform 0.5s ease;
        }

        .compass-needle::before {
            content: '';
            position: absolute;
            left: -8px;
            top: -6px;
            width: 0;
            height: 0;
            border-left: 8px solid #e17055;
            border-top: 7px solid transparent;
            border-bottom: 7px solid transparent;
        }

        .angle-input-section {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }

        .angle-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .input-group label {
            font-size: 0.9rem;
            color: #ddd;
            font-weight: 600;
        }

        .input-group input, .input-group select {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 10px;
            color: white;
            font-size: 1rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #74b9ff;
            box-shadow: 0 0 15px rgba(116, 185, 255, 0.3);
            background: rgba(116, 185, 255, 0.1);
        }

        .function-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .func-btn {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Courier New', monospace;
        }

        .func-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 184, 148, 0.4);
        }

        .func-btn.active {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            box-shadow: 0 0 20px rgba(253, 203, 110, 0.6);
        }

        .navigation-controls {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            flex: 1;
            min-width: 120px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(116, 185, 255, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: linear-gradient(135deg, #00b894, #00cec9);
        }

        .btn-success:hover {
            box-shadow: 0 10px 25px rgba(0, 184, 148, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
        }

        .btn-warning:hover {
            box-shadow: 0 10px 25px rgba(253, 203, 110, 0.4);
        }

        .mission-panel {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.2));
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .mission-title {
            color: #fdcb6e;
            font-size: 1.5rem;
            margin-bottom: 15px;
            text-align: center;
        }

        .mission-description {
            text-align: center;
            margin: 15px 0;
            line-height: 1.6;
            font-size: 1.1rem;
        }

        .treasure-info {
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }

        .distance-display {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ffd700;
            margin: 10px 0;
        }

        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
        }

        .stat-icon {
            font-size: 1.8rem;
            margin-bottom: 8px;
            display: block;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #74b9ff;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #ddd;
            font-size: 0.9rem;
        }

        .calculation-display {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            border-left: 4px solid #74b9ff;
        }

        .calculation-step {
            margin: 8px 0;
            padding: 5px;
            border-left: 3px solid #74b9ff;
            padding-left: 15px;
            opacity: 0;
            animation: fadeInStep 0.5s ease forwards;
        }

        @keyframes fadeInStep {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .alert {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-weight: 500;
            text-align: center;
            animation: slideIn 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-success {
            background: linear-gradient(135deg, rgba(0, 184, 148, 0.3), rgba(0, 206, 201, 0.2));
            border: 2px solid rgba(0, 184, 148, 0.5);
            color: #00b894;
        }

        .alert-info {
            background: linear-gradient(135deg, rgba(116, 185, 255, 0.3), rgba(9, 132, 227, 0.2));
            border: 2px solid rgba(116, 185, 255, 0.5);
            color: #74b9ff;
        }

        .alert-warning {
            background: linear-gradient(135deg, rgba(253, 203, 110, 0.3), rgba(225, 112, 85, 0.2));
            border: 2px solid rgba(253, 203, 110, 0.5);
            color: #fdcb6e;
        }

        .treasure-found {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s ease;
        }

        .treasure-found.show {
            opacity: 1;
            visibility: visible;
        }

        .treasure-content {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            transform: scale(0.8);
            transition: transform 0.5s ease;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            max-width: 500px;
        }

        .treasure-found.show .treasure-content {
            transform: scale(1);
        }

        .treasure-title {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: white;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
        }

        .achievement-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ffd700, #ff9ff3);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            margin: 5px;
            font-size: 0.9rem;
            font-weight: bold;
            animation: bounceIn 0.5s ease;
        }

        @keyframes bounceIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .hint-panel {
            background: linear-gradient(135deg, rgba(253, 203, 110, 0.2), rgba(225, 112, 85, 0.1));
            border: 2px solid rgba(253, 203, 110, 0.4);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            display: none;
            animation: slideDown 0.5s ease;
        }

        .hint-panel.show {
            display: block;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .level-progress {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            height: 30px;
            margin: 20px 0;
            overflow: hidden;
            position: relative;
        }

        .progress-bar {
            background: linear-gradient(90deg, #00b894, #00cec9, #74b9ff);
            height: 100%;
            width: 0%;
            transition: width 1s ease;
            border-radius: 15px;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            color: white;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
        }

        @media (max-width: 768px) {
            .navigation-panel {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .angle-inputs {
                grid-template-columns: 1fr;
            }

            .navigation-controls {
                flex-direction: column;
            }

            .function-buttons {
                grid-template-columns: 1fr;
            }

            .stats-panel {
                grid-template-columns: repeat(2, 1fr);
            }

            .difficulty-selector {
                flex-direction: column;
                align-items: center;
            }
        }

        .particle {
            position: absolute;
            pointer-events: none;
            z-index: 100;
        }

        @keyframes particleFloat {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-100px) scale(0.5); }
        }

        .sound-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            border: none;
            color: white;
            padding: 15px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 1001;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .sound-toggle:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <div class="ocean-background"></div>
    
    <button class="sound-toggle" onclick="toggleSound()" id="soundToggle">üîä</button>
    
    <div class="container">
        <div class="header">
            <h1>üß≠ NAVEGANTE TRIGONOM√âTRICO</h1>
            <p class="subtitle">Usa la trigonometr√≠a para navegar los oc√©anos y encontrar tesoros</p>
            
            <div class="difficulty-selector">
                <button class="difficulty-btn active" onclick="setDifficulty('facil')">üìö F√°cil</button>
                <button class="difficulty-btn" onclick="setDifficulty('medio')">‚öñÔ∏è Medio</button>
                <button class="difficulty-btn" onclick="setDifficulty('dificil')">üéØ Dif√≠cil</button>
            </div>

            <div class="level-progress">
                <div class="progress-bar" id="progressBar"></div>
                <div class="progress-text" id="progressText">Nivel 1 - 0/5 tesoros</div>
            </div>
        </div>

        <!-- Panel de Estad√≠sticas -->
        <div class="stats-panel">
            <div class="stat-card">
                <span class="stat-icon">üèÜ</span>
                <div class="stat-value" id="treasuresFound">0</div>
                <div class="stat-label">Tesoros Encontrados</div>
            </div>
            <div class="stat-card">
                <span class="stat-icon">üìç</span>
                <div class="stat-value" id="navigationAttempts">0</div>
                <div class="stat-label">Navegaciones</div>
            </div>
            <div class="stat-card">
                <span class="stat-icon">üéØ</span>
                <div class="stat-value" id="accuracy">0%</div>
                <div class="stat-label">Precisi√≥n</div>
            </div>
            <div class="stat-card">
                <span class="stat-icon">‚≠ê</span>
                <div class="stat-value" id="totalScore">0</div>
                <div class="stat-label">Puntuaci√≥n</div>
            </div>
        </div>

        <!-- Panel Principal de Navegaci√≥n -->
        <div class="navigation-panel">
            <!-- Estado del Barco -->
            <div class="ship-status">
                <h3 class="section-title">‚õµ Mi Barco</h3>
                <div class="ship-icon">üö¢</div>
                
                <div class="coordinate-display">
                    <div>Posici√≥n Actual:</div>
                    <div class="coordinate-value" id="currentPosition">
                        X: <span id="shipX">50.0</span><br>
                        Y: <span id="shipY">50.0</span>
                    </div>
                </div>

                <div class="coordinate-display">
                    <div>Rumbo Actual:</div>
                    <div class="coordinate-value" id="currentHeading">0¬∞</div>
                </div>

                <div class="coordinate-display">
                    <div>Distancia Navegada:</div>
                    <div class="coordinate-value" id="totalDistance">0.0 millas</div>
                </div>
            </div>

            <!-- Mapa del Oc√©ano -->
            <div class="ocean-map">
                <h3 class="section-title">üó∫Ô∏è Mapa de Navegaci√≥n</h3>
                
                <div class="map-canvas" id="mapCanvas">
                    <div class="ship-position" id="shipMarker">üö¢</div>
                    <div class="treasure-position" id="treasureMarker">üíé</div>
                </div>

                <div class="treasure-info">
                    <div class="mission-description" id="missionText">
                        üéØ Misi√≥n: Encuentra el tesoro usando trigonometr√≠a
                    </div>
                    <div class="distance-display" id="treasureDistance">
                        Distancia al tesoro: ? millas
                    </div>
                </div>
            </div>

            <!-- Herramientas de Br√∫jula -->
            <div class="compass-tools">
                <h3 class="section-title">üß≠ Instrumentos</h3>
                
                <div class="compass">
                    <div class="compass-needle" id="compassNeedle"></div>
                    <div style="position: absolute; color: #fdcb6e; font-weight: bold; top: 10px;">N</div>
                </div>

                <div class="angle-input-section">
                    <h4 style="text-align: center; margin-bottom: 15px; color: #fdcb6e;">üìê C√°lculos</h4>
                    
                    <div class="function-buttons">
                        <button class="func-btn active" onclick="selectFunction('sin')">SEN</button>
                        <button class="func-btn" onclick="selectFunction('cos')">COS</button>
                        <button class="func-btn" onclick="selectFunction('tan')">TAN</button>
                    </div>

                    <div class="angle-inputs">
                        <div class="input-group">
                            <label>√Ångulo (¬∞):</label>
                            <input type="number" id="angleInput" placeholder="0-360" min="0" max="360" step="0.1">
                        </div>
                        <div class="input-group">
                            <label>Distancia:</label>
                            <input type="number" id="distanceInput" placeholder="millas n√°uticas" min="1" max="50" step="0.1">
                        </div>
                    </div>

                    <div class="angle-inputs">
                        <div class="input-group">
                            <label>Resultado X:</label>
                            <input type="number" id="calculatedX" step="0.1" readonly>
                        </div>
                        <div class="input-group">
                            <label>Resultado Y:</label>
                            <input type="number" id="calculatedY" step="0.1" readonly>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Controles de Navegaci√≥n -->
        <div class="navigation-controls">
            <button class="btn" onclick="calculatePosition()">üìä Calcular Posici√≥n</button>
            <button class="btn btn-success" onclick="navigate()" id="navigateBtn" disabled>‚õµ Navegar</button>
            <button class="btn btn-warning" onclick="showHint()">üí° Pista</button>
            <button class="btn" onclick="newTreasure()">üó∫Ô∏è Nuevo Tesoro</button>
            <button class="btn" onclick="resetGame()">üîÑ Reiniciar</button>
        </div>

        <!-- Panel de Pistas -->
        <div class="hint-panel" id="hintPanel">
            <h3 style="color: #fdcb6e; text-align: center; margin-bottom: 15px;">üí° Pista Trigonom√©trica</h3>
            <div id="hintContent"></div>
        </div>

        <!-- Panel de Misi√≥n -->
        <div class="mission-panel">
            <h3 class="mission-title">üéØ Misi√≥n Actual</h3>
            <div class="mission-description" id="currentMission">
                Usa trigonometr√≠a para navegar hacia el tesoro. Calcula las coordenadas usando √°ngulos y distancias.
            </div>
            
            <div class="calculation-display" id="calculationSteps">
                <div class="calculation-step">1. Selecciona la funci√≥n trigonom√©trica apropiada</div>
                <div class="calculation-step">2. Ingresa el √°ngulo de navegaci√≥n (0¬∞ = Norte)</div>
                <div class="calculation-step">3. Ingresa la distancia a navegar</div>
                <div class="calculation-step">4. Calcula las nuevas coordenadas</div>
                <div class="calculation-step">5. Navega hacia la nueva posici√≥n</div>
            </div>
        </div>
    </div>

    <!-- Pantalla de Tesoro Encontrado -->
    <div class="treasure-found" id="treasureScreen">
        <div class="treasure-content">
            <h2 class="treasure-title">üèÜ ¬°TESORO ENCONTRADO!</h2>
            <div style="font-size: 4rem; margin: 20px 0;">üíé‚ú®</div>
            <p id="treasureMessage">¬°Has navegado exitosamente usando trigonometr√≠a!</p>
            <div id="treasureStats" style="margin: 20px 0;"></div>
            <div id="achievementBadges"></div>
            <button class="btn btn-success" onclick="nextTreasure()" style="margin-top: 20px;">
                üó∫Ô∏è Buscar Siguiente Tesoro
            </button>
            <button class="btn" onclick="closeTreasure()" style="margin-top: 10px;">
                üìä Continuar Navegando
            </button>
        </div>
    </div>

    <script>
         // Redirige si no hay usuario autenticado
        if (!localStorage.getItem('currentUser') && !sessionStorage.getItem('currentUser')) {
            window.location.href = "complete-login-html.html";
        }
        let gameState = {
            ship: { x: 50, y: 50 },
            treasure: { x: 0, y: 0 },
            currentFunction: 'sin',
            difficulty: 'facil',
            level: 1,
            treasuresInLevel: 0,
            treasuresPerLevel: 5,
            stats: {
                treasuresFound: 0,
                navigationAttempts: 0,
                successfulNavigations: 0,
                totalScore: 0,
                totalDistance: 0
            },
            mapSize: { width: 100, height: 100 },
            tolerance: { facil: 25, medio: 15, dificil: 8 },
            shipTrail: [],
            soundEnabled: true,
            achievements: new Set(),
            hintsUsed: 0
        };

        const trigFunctions = {
            sin: (angle, distance) => ({
                x: distance * Math.sin(angle * Math.PI / 180),
                y: distance * Math.cos(angle * Math.PI / 180),
                formula: `x = ${distance} √ó sin(${angle}¬∞) = ${(distance * Math.sin(angle * Math.PI / 180)).toFixed(2)}\ny = ${distance} √ó cos(${angle}¬∞) = ${(distance * Math.cos(angle * Math.PI / 180)).toFixed(2)}`
            }),
            cos: (angle, distance) => ({
                x: distance * Math.cos(angle * Math.PI / 180),
                y: distance * Math.sin(angle * Math.PI / 180),
                formula: `x = ${distance} √ó cos(${angle}¬∞) = ${(distance * Math.cos(angle * Math.PI / 180)).toFixed(2)}\ny = ${distance} √ó sin(${angle}¬∞) = ${(distance * Math.sin(angle * Math.PI / 180)).toFixed(2)}`
            }),
            tan: (angle, distance) => {
                const tanValue = Math.tan(angle * Math.PI / 180);
                let x, y;
                
                if (angle === 90 || angle === 270) {
                    x = 0;
                    y = angle === 90 ? distance : -distance;
                } else {
                    x = distance / Math.sqrt(1 + (tanValue * tanValue));
                    y = x * tanValue;
                    
                    if (angle > 90 && angle < 270) x = -Math.abs(x);
                    if (angle > 180) y = -Math.abs(y);
                }
                
                return {
                    x: x,
                    y: y,
                    formula: `tan(${angle}¬∞) = ${tanValue.toFixed(3)}\nx = ${distance} / ‚àö(1 + tan¬≤(${angle}¬∞)) = ${x.toFixed(2)}\ny = x √ó tan(${angle}¬∞) = ${y.toFixed(2)}`
                };
            }
        };

        const achievements = {
            'primer_tesoro': { name: 'üè¥‚Äç‚ò†Ô∏è Primer Tesoro', desc: 'Encuentra tu primer tesoro' },
            'navegante_experto': { name: 'üß≠ Navegante Experto', desc: 'Encuentra 5 tesoros' },
            'maestro_trigonometria': { name: 'üìê Maestro Trigonometr√≠a', desc: 'Usa las 3 funciones trigonom√©tricas' },
            'precision_perfecta': { name: 'üéØ Precisi√≥n Perfecta', desc: 'Navega con 90% de precisi√≥n' },
            'cazatesoros': { name: 'üíé Cazatesoros', desc: 'Encuentra 10 tesoros' },
            'sin_pistas': { name: 'üß† Navegaci√≥n Pura', desc: 'Encuentra un tesoro sin usar pistas' },
            'velocidad_luz': { name: '‚ö° Velocidad de Luz', desc: 'Encuentra un tesoro en menos de 30 segundos' },
            'explorador': { name: 'üó∫Ô∏è Explorador', desc: 'Navega m√°s de 500 millas' }
        };

        const hints = {
            facil: [
                "üß≠ Para ir hacia el Norte (arriba), usa un √°ngulo de 0¬∞",
                "üìê La funci√≥n SEN te da el desplazamiento horizontal (X)",
                "üìê La funci√≥n COS te da el desplazamiento vertical (Y)",
                "üéØ Imagina el mapa como un plano cartesiano con el barco en el centro",
                "üí° Si el tesoro est√° a la derecha, necesitas un √°ngulo entre 45¬∞ y 135¬∞"
            ],
            medio: [
                "üìä Recuerda: SEN(0¬∞) = 0, COS(0¬∞) = 1",
                "üîÑ Los √°ngulos se miden desde el Norte en sentido horario",
                "üìê Para √°ngulos mayores a 90¬∞, considera los signos de las funciones",
                "üéØ La distancia euclidiana se calcula con ‚àö((x‚ÇÇ-x‚ÇÅ)¬≤ + (y‚ÇÇ-y‚ÇÅ)¬≤)",
                "üí≠ Piensa en el c√≠rculo unitario para recordar los valores"
            ],
            dificil: [
                "üßÆ En el segundo cuadrante: SEN(+), COS(-), TAN(-)",
                "üìà Usa identidades: sin¬≤Œ∏ + cos¬≤Œ∏ = 1",
                "üîç Para TAN, considera las as√≠ntotas en 90¬∞ y 270¬∞",
                "‚öñÔ∏è Equilibra precisi√≥n con eficiencia en tus c√°lculos",
                "üé® Visualiza vectores para entender mejor las direcciones"
            ]
        };

        // Funciones de inicializaci√≥n
        function initGame() {
            generateNewTreasure();
            updateDisplay();
            updateCompass(0);
            showAlert('üéÆ ¬°Bienvenido, capit√°n! Usa la trigonometr√≠a para encontrar tesoros.', 'info');
            playSound('start');
        }

        function generateNewTreasure() {
            const difficulty = gameState.difficulty;
            let minDistance = { facil: 15, medio: 20, dificil: 25 }[difficulty];
            let maxDistance = { facil: 40, medio: 50, dificil: 60 }[difficulty];
            
            do {
                gameState.treasure.x = Math.random() * 80 + 10;
                gameState.treasure.y = Math.random() * 80 + 10;
            } while (calculateDistance(gameState.ship, gameState.treasure) < minDistance || 
                     calculateDistance(gameState.ship, gameState.treasure) > maxDistance);
            
            updateTreasurePosition();
            updateMissionText();
            gameState.hintsUsed = 0;
            
            // Reset calculation displays
            document.getElementById('calculatedX').value = '';
            document.getElementById('calculatedY').value = '';
            document.getElementById('navigateBtn').disabled = true;
        }

        // Funciones de c√°lculo y navegaci√≥n
        function calculateDistance(point1, point2) {
            return Math.sqrt(Math.pow(point2.x - point1.x, 2) + Math.pow(point2.y - point1.y, 2));
        }

        function selectFunction(func) {
            gameState.currentFunction = func;
            
            document.querySelectorAll('.func-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            updateCalculationSteps();
            playSound('click');
        }

        function calculatePosition() {
            const angle = parseFloat(document.getElementById('angleInput').value);
            const distance = parseFloat(document.getElementById('distanceInput').value);
            
            if (isNaN(angle) || isNaN(distance)) {
                showAlert('‚ö†Ô∏è Por favor ingresa valores v√°lidos para √°ngulo y distancia', 'warning');
                return;
            }
            
            if (angle < 0 || angle > 360) {
                showAlert('‚ö†Ô∏è El √°ngulo debe estar entre 0¬∞ y 360¬∞', 'warning');
                return;
            }
            
            if (distance < 1 || distance > 50) {
                showAlert('‚ö†Ô∏è La distancia debe estar entre 1 y 50 millas', 'warning');
                return;
            }
            
            const result = trigFunctions[gameState.currentFunction](angle, distance);
            
            const newX = Math.max(0, Math.min(100, gameState.ship.x + result.x));
            const newY = Math.max(0, Math.min(100, gameState.ship.y + result.y));
            
            document.getElementById('calculatedX').value = newX.toFixed(1);
            document.getElementById('calculatedY').value = newY.toFixed(1);
            document.getElementById('navigateBtn').disabled = false;
            
            updateCompass(angle);
            showCalculationSteps(angle, distance, result);
            
            showAlert(`üìä Posici√≥n calculada: (${newX.toFixed(1)}, ${newY.toFixed(1)})`, 'info');
            playSound('calculate');
        }

        function navigate() {
            const newX = parseFloat(document.getElementById('calculatedX').value);
            const newY = parseFloat(document.getElementById('calculatedY').value);
            
            if (isNaN(newX) || isNaN(newY)) {
                showAlert('‚ö†Ô∏è Primero calcula la nueva posici√≥n', 'warning');
                return;
            }
            
            // A√±adir rastro del barco
            gameState.shipTrail.push({x: gameState.ship.x, y: gameState.ship.y});
            if (gameState.shipTrail.length > 10) gameState.shipTrail.shift();
            
            // Mover el barco
            const oldPosition = {x: gameState.ship.x, y: gameState.ship.y};
            gameState.ship.x = newX;
            gameState.ship.y = newY;
            
            // Actualizar estad√≠sticas
            gameState.stats.navigationAttempts++;
            const distance = calculateDistance(oldPosition, gameState.ship);
            gameState.stats.totalDistance += distance;
            
            updateShipPosition();
            updateDisplay();
            
            // Verificar si encontr√≥ el tesoro
            const distanceToTreasure = calculateDistance(gameState.ship, gameState.treasure);
            const tolerance = gameState.tolerance[gameState.difficulty];
            
            if (distanceToTreasure <= tolerance) {
                treasureFound();
            } else {
                const message = distanceToTreasure <= tolerance * 1.5 ? 
                    'üî• ¬°Muy cerca! Sigue navegando' : 
                    'üåä Contin√∫a navegando hacia el tesoro';
                showAlert(message, 'info');
                playSound('navigate');
            }
            
            // Limpiar inputs para pr√≥xima navegaci√≥n
            document.getElementById('angleInput').value = '';
            document.getElementById('distanceInput').value = '';
            document.getElementById('calculatedX').value = '';
            document.getElementById('calculatedY').value = '';
            document.getElementById('navigateBtn').disabled = true;
            
            checkAchievements();
        }

        function treasureFound() {
            gameState.stats.treasuresFound++;
            gameState.stats.successfulNavigations++;
            gameState.treasuresInLevel++;
            
            // Calcular puntuaci√≥n
            const baseScore = { facil: 100, medio: 200, dificil: 300 }[gameState.difficulty];
            const hintPenalty = gameState.hintsUsed * 10;
            const accuracyBonus = gameState.stats.navigationAttempts > 0 ? 
                Math.round((gameState.stats.successfulNavigations / gameState.stats.navigationAttempts) * 100) : 0;
            
            const score = Math.max(50, baseScore - hintPenalty + accuracyBonus);
            gameState.stats.totalScore += score;
            
            updateDisplay();
            showTreasureScreen(score);
            playSound('treasure');
            createParticleEffect();
            
            checkAchievements();
            checkLevelUp();
        }

        // Funciones de interfaz
        function updateDisplay() {
            document.getElementById('shipX').textContent = gameState.ship.x.toFixed(1);
            document.getElementById('shipY').textContent = gameState.ship.y.toFixed(1);
            document.getElementById('treasuresFound').textContent = gameState.stats.treasuresFound;
            document.getElementById('navigationAttempts').textContent = gameState.stats.navigationAttempts;
            document.getElementById('totalScore').textContent = gameState.stats.totalScore;
            document.getElementById('totalDistance').textContent = gameState.stats.totalDistance.toFixed(1) + ' millas';
            
            const accuracy = gameState.stats.navigationAttempts > 0 ? 
                Math.round((gameState.stats.successfulNavigations / gameState.stats.navigationAttempts) * 100) : 0;
            document.getElementById('accuracy').textContent = accuracy + '%';
            
            const distanceToTreasure = calculateDistance(gameState.ship, gameState.treasure);
            document.getElementById('treasureDistance').textContent = `Distancia al tesoro: ${distanceToTreasure.toFixed(1)} millas`;
            
            updateProgressBar();
        }

        function updateProgressBar() {
            const progress = (gameState.treasuresInLevel / gameState.treasuresPerLevel) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').textContent = 
                `Nivel ${gameState.level} - ${gameState.treasuresInLevel}/${gameState.treasuresPerLevel} tesoros`;
        }

        function updateShipPosition() {
            const shipMarker = document.getElementById('shipMarker');
            shipMarker.style.left = gameState.ship.x + '%';
            shipMarker.style.top = (100 - gameState.ship.y) + '%';
            
            updateShipTrail();
        }

        function updateTreasurePosition() {
            const treasureMarker = document.getElementById('treasureMarker');
            treasureMarker.style.left = gameState.treasure.x + '%';
            treasureMarker.style.top = (100 - gameState.treasure.y) + '%';
        }

        function updateShipTrail() {
            // Limpiar rastros anteriores
            document.querySelectorAll('.ship-trail').forEach(trail => trail.remove());
            
            // Crear nuevos rastros
            gameState.shipTrail.forEach((point, index) => {
                const trail = document.createElement('div');
                trail.className = 'ship-trail';
                trail.style.left = point.x + '%';
                trail.style.top = (100 - point.y) + '%';
                trail.style.height = '10px';
                trail.style.opacity = (index + 1) / gameState.shipTrail.length * 0.5;
                document.getElementById('mapCanvas').appendChild(trail);
            });
        }

        function updateCompass(angle) {
            document.getElementById('compassNeedle').style.transform = `rotate(${angle}deg)`;
            document.getElementById('currentHeading').textContent = angle + '¬∞';
        }

        function showCalculationSteps(angle, distance, result) {
            const stepsContainer = document.getElementById('calculationSteps');
            const funcName = gameState.currentFunction.toUpperCase();
            
            stepsContainer.innerHTML = `
                <div class="calculation-step">1. Funci√≥n seleccionada: ${funcName}</div>
                <div class="calculation-step">2. √Ångulo: ${angle}¬∞, Distancia: ${distance} millas</div>
                <div class="calculation-step">3. C√°lculos:</div>
                <div class="calculation-step" style="font-size: 0.9rem; margin-left: 20px; white-space: pre-line;">${result.formula}</div>
                <div class="calculation-step">4. Nueva posici√≥n: (${(gameState.ship.x + result.x).toFixed(1)}, ${(gameState.ship.y + result.y).toFixed(1)})</div>
            `;
        }

        function showAlert(message, type) {
            const existingAlert = document.querySelector('.alert');
            if (existingAlert) existingAlert.remove();
            
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            
            document.querySelector('.container').appendChild(alert);
            
            setTimeout(() => {
                if (alert.parentNode) alert.remove();
            }, 4000);
        }

        function showTreasureScreen(score) {
            const screen = document.getElementById('treasureScreen');
            const message = document.getElementById('treasureMessage');
            const stats = document.getElementById('treasureStats');
            
            message.textContent = `¬°Excelente navegaci√≥n! Has encontrado el tesoro usando ${gameState.currentFunction.toUpperCase()}.`;
            stats.innerHTML = `
                <div style="font-size: 1.2rem; margin: 10px 0;">
                    <strong>Puntuaci√≥n obtenida: ${score} puntos</strong><br>
                    Navegaciones realizadas: ${gameState.stats.navigationAttempts}<br>
                    Pistas usadas: ${gameState.hintsUsed}
                </div>
            `;
            
            displayNewAchievements();
            screen.classList.add('show');
        }

        function displayNewAchievements() {
            const container = document.getElementById('achievementBadges');
            container.innerHTML = '';
            
            // Mostrar solo logros recientes (√∫ltimos 3)
            const recentAchievements = Array.from(gameState.achievements).slice(-3);
            recentAchievements.forEach(achievementId => {
                if (achievements[achievementId]) {
                    const badge = document.createElement('div');
                    badge.className = 'achievement-badge';
                    badge.textContent = achievements[achievementId].name;
                    badge.title = achievements[achievementId].desc;
                    container.appendChild(badge);
                }
            });
        }

        // Funciones de juego avanzadas
        function setDifficulty(level) {
            gameState.difficulty = level;
            
            document.querySelectorAll('.difficulty-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Reiniciar posici√≥n del barco y generar nuevo tesoro
            gameState.ship.x = 50;
            gameState.ship.y = 50;
            generateNewTreasure();
            updateShipPosition();
            
            const messages = {
                facil: 'üìö Dificultad F√°cil: Tolerancia de 25 millas',
                medio: '‚öñÔ∏è Dificultad Media: Tolerancia de 15 millas',
                dificil: 'üéØ Dificultad Dif√≠cil: Tolerancia de 8 millas'
            };
            
            showAlert(messages[level], 'info');
            playSound('click');
        }

        function showHint() {
            const hintPanel = document.getElementById('hintPanel');
            const hintContent = document.getElementById('hintContent');
            
            if (hintPanel.classList.contains('show')) {
                hintPanel.classList.remove('show');
                return;
            }
            
            gameState.hintsUsed++;
            const hintsForLevel = hints[gameState.difficulty];
            const randomHint = hintsForLevel[Math.floor(Math.random() * hintsForLevel.length)];
            
            // Pista espec√≠fica basada en la posici√≥n del tesoro
            const angle = Math.atan2(gameState.treasure.y - gameState.ship.y, gameState.treasure.x - gameState.ship.x) * 180 / Math.PI;
            const distance = calculateDistance(gameState.ship, gameState.treasure);
            
            let specificHint = '';
            if (angle >= -45 && angle <= 45) specificHint = 'El tesoro est√° hacia el ESTE ‚Üí';
            else if (angle > 45 && angle <= 135) specificHint = 'El tesoro est√° hacia el NORTE ‚Üë';
            else if (angle > 135 || angle <= -135) specificHint = 'El tesoro est√° hacia el OESTE ‚Üê';
            else specificHint = 'El tesoro est√° hacia el SUR ‚Üì';
            
            hintContent.innerHTML = `
                <div style="margin-bottom: 15px;"><strong>${randomHint}</strong></div>
                <div style="color: #74b9ff;">üß≠ ${specificHint}</div>
                <div style="color: #00cec9; margin-top: 10px;">üìè Distancia aproximada: ${Math.round(distance)} millas</div>
                <div style="color: #fdcb6e; font-size: 0.9rem; margin-top: 10px;">
                    üí∞ Usar pistas reduce tu puntuaci√≥n (-10 puntos por pista)
                </div>
            `;
            
            hintPanel.classList.add('show');
            playSound('hint');
        }

        function newTreasure() {
            generateNewTreasure();
            document.getElementById('hintPanel').classList.remove('show');
            showAlert('üó∫Ô∏è ¬°Nuevo tesoro generado! Comienza tu navegaci√≥n.', 'info');
            playSound('click');
        }

        function nextTreasure() {
            document.getElementById('treasureScreen').classList.remove('show');
            generateNewTreasure();
            document.getElementById('hintPanel').classList.remove('show');
        }

        function closeTreasure() {
            document.getElementById('treasureScreen').classList.remove('show');
        }

        function resetGame() {
            if (confirm('¬øEst√°s seguro de que quieres reiniciar el juego? Se perder√° todo el progreso.')) {
                gameState = {
                    ship: { x: 50, y: 50 },
                    treasure: { x: 0, y: 0 },
                    currentFunction: 'sin',
                    difficulty: 'facil',
                    level: 1,
                    treasuresInLevel: 0,
                    treasuresPerLevel: 5,
                    stats: {
                        treasuresFound: 0,
                        navigationAttempts: 0,
                        successfulNavigations: 0,
                        totalScore: 0,
                        totalDistance: 0
                    },
                    mapSize: { width: 100, height: 100 },
                    tolerance: { facil: 25, medio: 15, dificil: 8 },
                    shipTrail: [],
                    soundEnabled: true,
                    achievements: new Set(),
                    hintsUsed: 0
                };
                
                initGame();
                showAlert('üîÑ Juego reiniciado. ¬°Buena suerte, capit√°n!', 'info');
            }
        }

        function checkAchievements() {
            const stats = gameState.stats;
            const newAchievements = new Set();
            
            if (stats.treasuresFound >= 1 && !gameState.achievements.has('primer_tesoro')) {
                newAchievements.add('primer_tesoro');
            }
            
            if (stats.treasuresFound >= 5 && !gameState.achievements.has('navegante_experto')) {
                newAchievements.add('navegante_experto');
            }
            
            if (stats.treasuresFound >= 10 && !gameState.achievements.has('cazatesoros')) {
                newAchievements.add('cazatesoros');
            }
            
            const accuracy = stats.navigationAttempts > 0 ? 
                (stats.successfulNavigations / stats.navigationAttempts) * 100 : 0;
            if (accuracy >= 90 && stats.navigationAttempts >= 5 && !gameState.achievements.has('precision_perfecta')) {
                newAchievements.add('precision_perfecta');
            }
            
            if (stats.totalDistance >= 500 && !gameState.achievements.has('explorador')) {
                newAchievements.add('explorador');
            }
            
            if (gameState.hintsUsed === 0 && stats.treasuresFound > 0 && !gameState.achievements.has('sin_pistas')) {
                newAchievements.add('sin_pistas');
            }
            
            // A√±adir nuevos logros
            newAchievements.forEach(achievement => {
                gameState.achievements.add(achievement);
                if (gameState.soundEnabled) playSound('achievement');
            });
        }

        function checkLevelUp() {
            if (gameState.treasuresInLevel >= gameState.treasuresPerLevel) {
                gameState.level++;
                gameState.treasuresInLevel = 0;
                gameState.treasuresPerLevel += 2; // Aumentar dificultad
                
                showAlert(`üéâ ¬°NIVEL ${gameState.level}! Ahora necesitas ${gameState.treasuresPerLevel} tesoros por nivel.`, 'success');
                
                // Bonus por subir de nivel
                gameState.stats.totalScore += gameState.level * 100;
                updateDisplay();
            }
        }

        function updateMissionText() {
            const missions = [
                "üéØ Encuentra el tesoro dorado usando c√°lculos trigonom√©tricos precisos",
                "üó∫Ô∏è Navega hacia el tesoro perdido con ayuda de la trigonometr√≠a",
                "üíé Localiza el cofre del tesoro calculando coordenadas exactas",
                "‚öì Usa tus conocimientos de navegaci√≥n para llegar al tesoro",
                "üß≠ Emplea funciones trigonom√©tricas para trazar tu ruta al tesoro"
            ];
            
            const mission = missions[Math.floor(Math.random() * missions.length)];
            document.getElementById('missionText').textContent = mission;
        }

        function updateCalculationSteps() {
            const func = gameState.currentFunction;
            const descriptions = {
                sin: "SEN se usa para calcular desplazamientos horizontales desde un √°ngulo",
                cos: "COS se usa para calcular desplazamientos verticales desde un √°ngulo", 
                tan: "TAN relaciona los desplazamientos X e Y directamente"
            };
            
            document.getElementById('calculationSteps').innerHTML = `
                <div class="calculation-step">1. Funci√≥n ${func.toUpperCase()}: ${descriptions[func]}</div>
                <div class="calculation-step">2. Ingresa el √°ngulo de navegaci√≥n (0¬∞ = Norte)</div>
                <div class="calculation-step">3. Ingresa la distancia a navegar</div>
                <div class="calculation-step">4. Calcula las nuevas coordenadas</div>
                <div class="calculation-step">5. Navega hacia la nueva posici√≥n</div>
            `;
        }

        // Funciones de efectos y sonido
        function createParticleEffect() {
            const colors = ['#ffd700', '#ffed4e', '#ff9ff3', '#74b9ff', '#00cec9'];
            
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.position = 'fixed';
                    particle.style.left = '50%';
                    particle.style.top = '50%';
                    particle.style.width = '6px';
                    particle.style.height = '6px';
                    particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    particle.style.borderRadius = '50%';
                    particle.style.pointerEvents = 'none';
                    particle.style.zIndex = '1001';
                    
                    const angle = (Math.PI * 2 * i) / 20;
                    const velocity = Math.random() * 100 + 50;
                    
                    particle.style.animation = `particleFloat 2s ease-out forwards`;
                    particle.style.transform = `translate(-50%, -50%) translate(${Math.cos(angle) * velocity}px, ${Math.sin(angle) * velocity}px)`;
                    
                    document.body.appendChild(particle);
                    
                    setTimeout(() => particle.remove(), 2000);
                }, i * 50);
            }
        }

        function playSound(type) {
            if (!gameState.soundEnabled) return;
            
            // Crear contexto de audio simple para feedback sonoro
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const                 oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                const frequencies = {
                    start: 440,
                    click: 800,
                    calculate: 600,
                    navigate: 500,
                    treasure: 880,
                    achievement: 1000,
                    hint: 350
                };
                
                oscillator.frequency.value = frequencies[type] || 440;
                oscillator.type = type === 'treasure' ? 'triangle' : 'sine';
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.3);
            } catch (e) {
                console.log('Audio no disponible');
            }
        }

        function toggleSound() {
            gameState.soundEnabled = !gameState.soundEnabled;
            const btn = document.getElementById('soundToggle');
            btn.textContent = gameState.soundEnabled ? 'üîä' : 'üîá';
            
            showAlert(gameState.soundEnabled ? 'üîä Sonido activado' : 'üîá Sonido desactivado', 'info');
        }

        // Event listeners para mejorar la experiencia
        document.addEventListener('DOMContentLoaded', function() {
            initGame();
            
            // Permitir Enter para calcular y navegar
            document.getElementById('distanceInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    calculatePosition();
                }
            });
            
            document.getElementById('angleInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    calculatePosition();
                }
            });
            
            // Auto-validaci√≥n de inputs
            document.getElementById('angleInput').addEventListener('input', function(e) {
                const value = parseFloat(e.target.value);
                if (value < 0) e.target.value = 0;
                if (value > 360) e.target.value = 360;
            });
            
            document.getElementById('distanceInput').addEventListener('input', function(e) {
                const value = parseFloat(e.target.value);
                if (value < 1) e.target.value = 1;
                if (value > 50) e.target.value = 50;
            });
            
            // Efectos de hover para el mapa
            const mapCanvas = document.getElementById('mapCanvas');
            mapCanvas.addEventListener('mousemove', function(e) {
                const rect = mapCanvas.getBoundingClientRect();
                const x = ((e.clientX - rect.left) / rect.width) * 100;
                const y = ((rect.bottom - e.clientY) / rect.height) * 100;
                
                mapCanvas.title = `Coordenadas: (${x.toFixed(1)}, ${y.toFixed(1)})`;
            });
            
            // Guardar progreso en localStorage (si est√° disponible)
            window.addEventListener('beforeunload', function() {
                try {
                    localStorage.setItem('naveganteTrigonometrico', JSON.stringify({
                        stats: gameState.stats,
                        achievements: Array.from(gameState.achievements),
                        level: gameState.level,
                        difficulty: gameState.difficulty
                    }));
                } catch (e) {
                    console.log('No se pudo guardar el progreso');
                }
            });
            
            // Cargar progreso guardado
            try {
                const saved = localStorage.getItem('naveganteTrigonometrico');
                if (saved) {
                    const data = JSON.parse(saved);
                    gameState.stats = data.stats || gameState.stats;
                    gameState.achievements = new Set(data.achievements || []);
                    gameState.level = data.level || 1;
                    gameState.difficulty = data.difficulty || 'facil';
                    
                    // Actualizar UI con datos guardados
                    updateDisplay();
                    setDifficulty(gameState.difficulty);
                }
            } catch (e) {
                console.log('No se pudo cargar el progreso guardado');
            }
        });

        // Funciones adicionales de utilidad
        function exportProgress() {
            const data = {
                stats: gameState.stats,
                achievements: Array.from(gameState.achievements),
                level: gameState.level,
                totalTime: Date.now()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'navegante_trigonometrico_progreso.json';
            link.click();
        }

        // Funci√≥n para mostrar estad√≠sticas detalladas
        function showDetailedStats() {
            const accuracy = gameState.stats.navigationAttempts > 0 ? 
                ((gameState.stats.successfulNavigations / gameState.stats.navigationAttempts) * 100).toFixed(1) : 0;
                
            const avgScore = gameState.stats.treasuresFound > 0 ? 
                (gameState.stats.totalScore / gameState.stats.treasuresFound).toFixed(0) : 0;
                
            const achievementCount = gameState.achievements.size;
            const totalAchievements = Object.keys(achievements).length;
            
            const statsHTML = `
                <div style="background: rgba(0,0,0,0.8); color: white; padding: 20px; border-radius: 15px; max-width: 400px; margin: 20px auto;">
                    <h3 style="text-align: center; color: #74b9ff; margin-bottom: 20px;">üìä Estad√≠sticas Detalladas</h3>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <div>üèÜ Tesoros: <strong>${gameState.stats.treasuresFound}</strong></div>
                        <div>üéØ Precisi√≥n: <strong>${accuracy}%</strong></div>
                        <div>‚≠ê Puntuaci√≥n: <strong>${gameState.stats.totalScore}</strong></div>
                        <div>üìà Promedio: <strong>${avgScore} pts</strong></div>
                        <div>üó∫Ô∏è Distancia: <strong>${gameState.stats.totalDistance.toFixed(1)}m</strong></div>
                        <div>üèÖ Logros: <strong>${achievementCount}/${totalAchievements}</strong></div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <strong>üèÜ Logros Obtenidos:</strong><br>
                        ${Array.from(gameState.achievements).map(id => 
                            `<span style="color: #ffd700;">‚Ä¢ ${achievements[id]?.name || id}</span>`
                        ).join('<br>') || '<em>Ning√∫n logro a√∫n</em>'}
                    </div>
                    
                    <button onclick="this.parentElement.remove()" style="
                        background: #74b9ff; color: white; border: none; padding: 10px 20px; 
                        border-radius: 8px; cursor: pointer; margin-top: 20px; width: 100%;
                    ">Cerrar</button>
                </div>
            `;
            
            const statsDiv = document.createElement('div');
            statsDiv.innerHTML = statsHTML;
            statsDiv.style.position = 'fixed';
            statsDiv.style.top = '0';
            statsDiv.style.left = '0';
            statsDiv.style.width = '100%';
            statsDiv.style.height = '100%';
            statsDiv.style.background = 'rgba(0,0,0,0.7)';
            statsDiv.style.display = 'flex';
            statsDiv.style.alignItems = 'center';
            statsDiv.style.justifyContent = 'center';
            statsDiv.style.zIndex = '1002';
            
            document.body.appendChild(statsDiv);
        }

        // A√±adir bot√≥n de estad√≠sticas detalladas
        setTimeout(() => {
            const statsButton = document.createElement('button');
            statsButton.textContent = 'üìä';
            statsButton.onclick = showDetailedStats;
            statsButton.style.cssText = `
                position: fixed; top: 20px; right: 80px; background: linear-gradient(135deg, #00b894, #00cec9);
                border: none; color: white; padding: 15px; border-radius: 50%; cursor: pointer;
                z-index: 1001; font-size: 1.2rem; transition: all 0.3s ease;
            `;
            statsButton.onmouseenter = () => statsButton.style.transform = 'scale(1.1)';
            statsButton.onmouseleave = () => statsButton.style.transform = 'scale(1)';
            
            document.body.appendChild(statsButton);
        }, 1000);

        // Sistema de consejos inteligentes
        function getSmartHint() {
            const distanceToTreasure = calculateDistance(gameState.ship, gameState.treasure);
            const angle = Math.atan2(gameState.treasure.x - gameState.ship.x, gameState.treasure.y - gameState.ship.y) * 180 / Math.PI;
            const correctedAngle = angle < 0 ? angle + 360 : angle;
            
            let smartHint = '';
            
            // Sugerencia de funci√≥n trigonom√©trica basada en el √°ngulo
            if (correctedAngle >= 315 || correctedAngle < 45) {
                smartHint = `üí° Para ir al Norte (${correctedAngle.toFixed(0)}¬∞), COS da el desplazamiento Y principal`;
            } else if (correctedAngle >= 45 && correctedAngle < 135) {
                smartHint = `üí° Para ir al Este (${correctedAngle.toFixed(0)}¬∞), SEN da el desplazamiento X principal`;
            } else if (correctedAngle >= 135 && correctedAngle < 225) {
                smartHint = `üí° Para ir al Sur (${correctedAngle.toFixed(0)}¬∞), considera √°ngulos negativos en COS`;
            } else {
                smartHint = `üí° Para ir al Oeste (${correctedAngle.toFixed(0)}¬∞), considera √°ngulos negativos en SEN`;
            }
            
            // Sugerencia de distancia
            const suggestedDistance = Math.min(distanceToTreasure * 0.8, 25);
            smartHint += `<br>üìè Intenta con una distancia de aproximadamente ${suggestedDistance.toFixed(0)} millas`;
            
            return smartHint;
        }

        // Mejorar la funci√≥n showHint para incluir consejos inteligentes
        const originalShowHint = showHint;
        showHint = function() {
            const hintPanel = document.getElementById('hintPanel');
            const hintContent = document.getElementById('hintContent');
            
            if (hintPanel.classList.contains('show')) {
                hintPanel.classList.remove('show');
                return;
            }
            
            gameState.hintsUsed++;
            const hintsForLevel = hints[gameState.difficulty];
            const randomHint = hintsForLevel[Math.floor(Math.random() * hintsForLevel.length)];
            const smartHint = getSmartHint();
            
            hintContent.innerHTML = `
                <div style="margin-bottom: 15px;"><strong>${randomHint}</strong></div>
                <div style="color: #74b9ff; margin-bottom: 15px;">${smartHint}</div>
                <div style="color: #fdcb6e; font-size: 0.9rem;">
                    üí∞ Usar pistas reduce tu puntuaci√≥n (-10 puntos por pista)
                </div>
            `;
            
            hintPanel.classList.add('show');
            playSound('hint');
        };

        console.log('üéÆ Navegante Trigonom√©trico cargado correctamente');
        console.log('üß≠ Consejos: Usa las funciones SEN, COS y TAN para calcular tus movimientos');
        console.log('üìê Recuerda: 0¬∞ = Norte, 90¬∞ = Este, 180¬∞ = Sur, 270¬∞ = Oeste');
    </script>
</body>
</html>