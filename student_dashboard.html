<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XZ1QWD1TCC"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XZ1QWD1TCC');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Dashboard - MateJuegos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            min-height: 100vh;
            color: #f8fafc;
        }

        /* Header */
        .header {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #3b82f6;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo::before {
            content: "üßÆ";
            font-size: 2rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            font-weight: bold;
        }

        .welcome-text {
            color: #cbd5e1;
        }

        .welcome-text h2 {
            color: white;
            font-size: 1.2rem;
            margin-bottom: 0.2rem;
        }

        .logout-btn {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        /* Main Layout */
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 2rem;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        /* Cards Base */
        .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 2rem;
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            border-color: rgba(59, 130, 246, 0.3);
        }

        /* Welcome Section */
        .welcome-section {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: white;
            position: relative;
            overflow: hidden;
        }

        .welcome-section::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 200px;
            height: 200px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="50" font-size="60">üìä</text></svg>') no-repeat center;
            opacity: 0.1;
            transform: translate(50%, -50%);
        }

        .welcome-content {
            position: relative;
            z-index: 2;
        }

        .welcome-section h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .grade-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2rem;
            margin-top: 2rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        /* Progress Section */
        .progress-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .progress-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .progress-card:hover {
            transform: translateY(-5px);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .progress-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .progress-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #f1f5f9;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            margin: 1rem 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            border-radius: 4px;
            transition: width 1s ease;
        }

        .progress-text {
            color: #cbd5e1;
            font-size: 0.9rem;
        }

        /* Games Grid */
        .games-section h2 {
            color: #f1f5f9;
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .game-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .game-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .game-header {
            padding: 1.5rem 1.5rem 1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .game-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .game-info h3 {
            color: #f1f5f9;
            font-size: 1.1rem;
            margin-bottom: 0.3rem;
        }

        .game-category {
            color: #64748b;
            font-size: 0.9rem;
        }

        .game-progress {
            padding: 0 1.5rem 1.5rem 1.5rem;
        }

        .game-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .status-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-new {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }

        .status-progress {
            background: rgba(249, 115, 22, 0.2);
            color: #f97316;
        }

        .status-completed {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }

        .status-locked {
            background: rgba(100, 116, 139, 0.2);
            color: #64748b;
        }

        .stars {
            display: flex;
            gap: 0.2rem;
        }

        .star {
            color: #fbbf24;
            font-size: 1rem;
        }

        .star.empty {
            color: #374151;
        }

        .play-btn {
            width: 100%;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: white;
            border: none;
            padding: 0.8rem;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .play-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }

        .play-btn:disabled {
            background: rgba(100, 116, 139, 0.5);
            cursor: not-allowed;
            transform: none;
        }

        /* Sidebar Cards */
        .achievements-card,
        .leaderboard-card,
        .streak-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 1.5rem;
        }

        .achievements-card h3,
        .leaderboard-card h3,
        .streak-card h3 {
            color: #f1f5f9;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .achievement-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.8rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .achievement-item:last-child {
            border-bottom: none;
        }

        .achievement-icon {
            font-size: 2rem;
        }

        .achievement-info h4 {
            color: #f1f5f9;
            font-size: 0.9rem;
            margin-bottom: 0.2rem;
        }

        .achievement-desc {
            color: #94a3b8;
            font-size: 0.8rem;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .leaderboard-item:last-child {
            border-bottom: none;
        }

        .leaderboard-position {
            font-weight: bold;
            color: #3b82f6;
        }

        .leaderboard-name {
            color: #f1f5f9;
        }

        .leaderboard-score {
            color: #fbbf24;
            font-weight: 600;
        }

        .streak-number {
            font-size: 3rem;
            font-weight: bold;
            text-align: center;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .streak-text {
            text-align: center;
            color: #cbd5e1;
        }

        .streak-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.3rem;
            margin-top: 1rem;
        }

        .calendar-day {
            aspect-ratio: 1;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            background: rgba(255, 255, 255, 0.1);
            color: #64748b;
        }

        .calendar-day.active {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: white;
        }

        .calendar-day.today {
            border: 2px solid #fbbf24;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .dashboard-container {
                grid-template-columns: 1fr;
            }

            .sidebar {
                order: -1;
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 1rem;
            }
        }

        @media (max-width: 768px) {
            .dashboard-container {
                padding: 1rem;
            }

            .quick-stats {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .games-grid {
                grid-template-columns: 1fr;
            }

            .header-content {
                padding: 0 1rem;
            }

            .user-info {
                gap: 0.5rem;
            }

            .welcome-text {
                display: none;
            }
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card {
            animation: fadeInUp 0.6s ease forwards;
        }

        .game-card:nth-child(1) { animation-delay: 0.1s; }
        .game-card:nth-child(2) { animation-delay: 0.2s; }
        .game-card:nth-child(3) { animation-delay: 0.3s; }
        .game-card:nth-child(4) { animation-delay: 0.4s; }
        .game-card:nth-child(5) { animation-delay: 0.5s; }
        .game-card:nth-child(6) { animation-delay: 0.6s; }

        /* Floating Math Symbols */
        .math-float {
            position: fixed;
            pointer-events: none;
            z-index: -1;
            animation: mathFloat 15s linear infinite;
            opacity: 0.05;
            font-size: 2rem;
            color: #3b82f6;
        }

        @keyframes mathFloat {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10%, 90% {
                opacity: 0.05;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">MateJuegos</div>
            <div class="user-info">
                <div class="welcome-text">
                    <h2>¬°Hola, Mar√≠a!</h2>
                    <p>8¬∞ Grado - Colegio San Patricio</p>
                </div>
                <div class="user-avatar" id="userAvatar">M</div>
                <a href="index.html" class="logout-btn" onclick="logout()">Salir</a>
            </div>
        </div>
    </header>

    <div class="dashboard-container">
        <main class="main-content">
            <!-- Welcome Section -->
            <section class="welcome-section card">
                <div class="welcome-content">
                    <div class="grade-badge">8¬∞ Grado</div>
                    <h1>¬°Bienvenida a tu aventura matem√°tica!</h1>
                    <p>Contin√∫a aprendiendo y divirti√©ndote con nuestros juegos interactivos dise√±ados especialmente para ti.</p>
                    
                    <div class="quick-stats">
                        <div class="stat-item">
                            <div class="stat-number" id="gamesCompleted">12</div>
                            <div class="stat-label">Juegos Completados</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="totalPoints">2,450</div>
                            <div class="stat-label">Puntos Totales</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="currentLevel">8</div>
                            <div class="stat-label">Nivel Actual</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Progress Overview -->
            <section class="progress-section">
                <div class="progress-card">
                    <div class="progress-icon">üìä</div>
                    <div class="progress-title">√Ålgebra</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 75%;"></div>
                    </div>
                    <div class="progress-text">75% completado</div>
                </div>

                <div class="progress-card">
                    <div class="progress-icon">üìê</div>
                    <div class="progress-title">Geometr√≠a</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 60%;"></div>
                    </div>
                    <div class="progress-text">60% completado</div>
                </div>

                <div class="progress-card">
                    <div class="progress-icon">üìà</div>
                    <div class="progress-title">Estad√≠stica</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 45%;"></div>
                    </div>
                    <div class="progress-text">45% completado</div>
                </div>
            </section>

            <!-- Games Section -->
            <section class="games-section">
                <h2>üéÆ Tus Juegos</h2>
                <div class="games-grid" id="gamesGrid">
                    <!-- Los juegos se cargar√°n din√°micamente -->
                </div>
            </section>
        </main>

        <aside class="sidebar">
            <!-- Achievements -->
            <div class="achievements-card">
                <h3>üèÜ Logros Recientes</h3>
                <div class="achievement-item">
                    <div class="achievement-icon">üî•</div>
                    <div class="achievement-info">
                        <h4>Racha de Fuego</h4>
                        <div class="achievement-desc">7 d√≠as consecutivos jugando</div>
                    </div>
                </div>
                <div class="achievement-item">
                    <div class="achievement-icon">üéØ</div>
                    <div class="achievement-info">
                        <h4>Precisi√≥n Total</h4>
                        <div class="achievement-desc">100% en ecuaciones lineales</div>
                    </div>
                </div>
                <div class="achievement-item">
                    <div class="achievement-icon">‚ö°</div>
                    <div class="achievement-info">
                        <h4>Velocidad Luz</h4>
                        <div class="achievement-desc">Resolviste 10 problemas en 2 min</div>
                    </div>
                </div>
            </div>

            <!-- Streak Calendar -->
            <div class="streak-card">
                <h3>üìÖ Racha de Estudio</h3>
                <div class="streak-number" id="streakCount">7</div>
                <div class="streak-text">d√≠as consecutivos</div>
                <div class="streak-calendar" id="streakCalendar">
                    <!-- Se genera din√°micamente -->
                </div>
            </div>

            <!-- Leaderboard -->
            <div class="leaderboard-card">
                <h3>ü•á Ranking del Grado</h3>
                <div class="leaderboard-item">
                    <span class="leaderboard-position">#1</span>
                    <span class="leaderboard-name">Carlos M.</span>
                    <span class="leaderboard-score">3,200 pts</span>
                </div>
                <div class="leaderboard-item">
                    <span class="leaderboard-position">#2</span>
                    <span class="leaderboard-name">Ana L.</span>
                    <span class="leaderboard-score">2,890 pts</span>
                </div>
                <div class="leaderboard-item" style="background: rgba(59, 130, 246, 0.1); border-radius: 8px; margin: 0 -8px; padding-left: 8px; padding-right: 8px;">
                    <span class="leaderboard-position">#3</span>
                    <span class="leaderboard-name">T√∫ (Mar√≠a)</span>
                    <span class="leaderboard-score">2,450 pts</span>
                </div>
                <div class="leaderboard-item">
                    <span class="leaderboard-position">#4</span>
                    <span class="leaderboard-name">Diego P.</span>
                    <span class="leaderboard-score">2,100 pts</span>
                </div>
                <div class="leaderboard-item">
                    <span class="leaderboard-position">#5</span>
                    <span class="leaderboard-name">Sofia R.</span>
                    <span class="leaderboard-score">1,950 pts</span>
                </div>
            </div>
        </aside>
    </div>

    <script>
        // Obtener datos del usuario autenticado
        const user = JSON.parse(localStorage.getItem('currentUser') || sessionStorage.getItem('currentUser'));
        if (!user) {
            window.location.href = "complete-login-html.html";
        }
        const metrics = user.metrics;

        // Datos del estudiante reales
        const studentData = {
            name: `${user.firstName} ${user.lastName}`,
            grade: user.grade,
            school: user.institution,
            totalPoints: metrics.totalPoints,
            gamesCompleted: metrics.gamesCompleted,
            level: metrics.level,
            streak: metrics.streak,
            avatar: user.avatar || user.firstName[0],
            progress: metrics.progress,
            visits: metrics.visits
        };

const gradeContent = {
    6: {
        topics: [
            "N√∫meros enteros y operaciones",
            "Fracciones y decimales",
            "Geometr√≠a b√°sica (per√≠metros, √°reas)",
            "Introducci√≥n a la estad√≠stica (frecuencias, gr√°ficos)"
        ],
        games: [
            { title: "Batalla de Fracciones", description: "Comparaci√≥n y operaciones con fracciones", icon: "‚öîÔ∏è", file: "batalla_de_fracciones.html" },
            { title: "Constructor de Figuras", description: "Per√≠metros y √°reas", icon: "üèóÔ∏è", file: "constructor_figuras.html" },
            { title: "Detective de Datos", description: "Interpretaci√≥n de gr√°ficas b√°sicas", icon: "üïµÔ∏è‚Äç‚ôÇÔ∏è", file: "detective-datos-game.html" },
            { title: "Analista de Datos", description: "Media, mediana, moda", icon: "üìä", file: "data_analyst_game.html" }
        ]
    },
    7: {
        topics: [
            "N√∫meros racionales",
            "Proporcionalidad",
            "Geometr√≠a (c√≠rculos, pol√≠gonos)",
            "Probabilidad b√°sica"
        ],
        games: [
            { title: "Mercado Virtual", description: "Proporciones y porcentajes", icon: "üõí", file: "mercado_virtual.html" },
            { title: "Ruleta de Probabilidades", description: "Probabilidad b√°sica", icon: "üé°", file: "ruleta_probabilidades.html" },
            { title: "Arquitecto Geom√©trico", description: "Construcci√≥n de figuras", icon: "üèõÔ∏è", file: "arquitecto_geometrico.html" },
            { title: "Detective de Datos", description: "Interpretaci√≥n de gr√°ficas b√°sicas", icon: "üïµÔ∏è‚Äç‚ôÇÔ∏è", file: "detective-datos-game.html" }
        ]
    },
    8: {
        topics: [
            "Expresiones algebraicas",
            "Ecuaciones lineales",
            "Teorema de Pit√°goras",
            "Medidas de tendencia central"
        ],
        games: [
            { title: "√Ålgebra Quest", description: "Resoluci√≥n de ecuaciones", icon: "üßô‚Äç‚ôÇÔ∏è", file: "algebra_quest.html" },
            { title: "Misi√≥n Pit√°goras", description: "Aplicaciones del teorema", icon: "üìê", file: "mision-pitagoras-game.html" },
            { title: "Analista de Datos", description: "Media, mediana, moda", icon: "üìä", file: "data_analyst_game.html" },
            { title: "Detective de Datos", description: "Interpretaci√≥n de gr√°ficas b√°sicas", icon: "üïµÔ∏è‚Äç‚ôÇÔ∏è", file: "detective-datos-game.html" },
            { title: "Ruleta de Probabilidades", description: "Probabilidad b√°sica", icon: "üé°", file: "ruleta_probabilidades.html" }
        ]
    },
    9: {
        topics: [
            "Funciones lineales y cuadr√°ticas",
            "Geometr√≠a anal√≠tica",
            "Estad√≠stica descriptiva avanzada",
            "Sistemas de ecuaciones"
        ],
        games: [
            { title: "Graficador Espacial", description: "Funciones en el plano cartesiano", icon: "üó∫Ô∏è",file: "batalla_fracciones.html"  },
            { title: "Laboratorio Estad√≠stico", description: "Estad√≠stica avanzada", icon: "üî¨", file: "laboratorio_estadistico.html" },
            { title: "Guerra de sistemas", description: "Ecuaciones simult√°neas", icon: "üî¢", file: "guerra_sistemas_ecuaciones.html" },
            { title: "Detective de Datos", description: "Interpretaci√≥n de gr√°ficas b√°sicas", icon: "üïµÔ∏è‚Äç‚ôÇÔ∏è", file: "detective-datos-game.html" }
        ]
    },
    10: {
        topics: [
            "Trigonometr√≠a",
            "Logaritmos y exponenciales",
            "Estad√≠stica inferencial b√°sica",
            "Geometr√≠a del espacio"
        ],
        games: [
            { title: "Navegante Trigonom√©trico", description: "Aplicaciones trigonom√©tricas", icon: "üß≠", file: "navegante_trigonometrico.html" },
            { title: "Explorador Exponencial", description: "Logaritmos y exponenciales", icon: "üöÄ", file: "explorador_exponencial.html" },
            { title: "Inspector de Muestras", description: "Estad√≠stica inferencial", icon: "üîé", file: "inspector_muestras.html" },
            { title: "Detective de Datos", description: "Interpretaci√≥n de gr√°ficas b√°sicas", icon: "üïµÔ∏è‚Äç‚ôÇÔ∏è", file: "detective-datos-game.html" },
            { title: "Misi√≥n Pit√°goras", description: "Aplicaciones del teorema", icon: "üìê", file: "mision-pitagoras-game.html" }
        ]
    },
    11: {
        topics: [
            "C√°lculo diferencial b√°sico",
            "Combinatoria y probabilidad avanzada",
            "Estad√≠stica aplicada",
            "Preparaci√≥n pruebas SABER 11"
        ],
        games: [
            { title: "Simulador SABER 11", description: "Preguntas tipo examen", icon: "üìù", file: "simulador_saber11.html" },
            { title: "Casino Matem√°tico", description: "Probabilidades complejas", icon: "üé∞", file: "casino_matematico.html" },
            { title: "Derivadas en Acci√≥n", description: "C√°lculo diferencial", icon: "üìà", file: "derivadas_en_accion.html" },
            { title: "Detective de Datos", description: "Interpretaci√≥n de gr√°ficas b√°sicas", icon: "üïµÔ∏è‚Äç‚ôÇÔ∏è", file: "detective-datos-game.html" }
        ]
    }
};

// Datos de los juegos
const gamesData = [
    {
        id: 1,
        title: "√Ålgebra Quest",
        category: "Expresiones Algebraicas",
        icon: "üßô‚Äç‚ôÇÔ∏è",
        status: "completed",
        progress: 100,
        stars: 3,
        points: 250,
        description: "Domina las expresiones algebraicas"
    },
    {
        id: 2,
        title: "Ecuaciones Lineales",
        category: "√Ålgebra",
        icon: "‚öñÔ∏è",
        status: "progress",
        progress: 65,
        stars: 2,
        points: 180,
        description: "Resuelve ecuaciones de primer grado"
    },
    {
        id: 3,
        title: "Teorema de Pit√°goras",
        category: "Geometr√≠a",
        icon: "üìê",
        status: "new",
        progress: 0,
        stars: 0,
        points: 0,
        description: "Explora los tri√°ngulos rect√°ngulos"
    },
    {
        id: 4,
        title: "Gr√°ficas Estad√≠sticas",
        category: "Estad√≠stica",
        icon: "üìä",
        status: "progress",
        progress: 30,
        stars: 1,
        points: 75,
        description: "Interpreta y crea gr√°ficas"
    },
    {
        id: 5,
        title: "Sistemas de Ecuaciones",
        category: "√Ålgebra Avanzada",
        icon: "üî¢",
        status: "locked",
        progress: 0,
        stars: 0,
        points: 0,
        description: "Desbloquea completando Ecuaciones Lineales"
    },
    {
        id: 6,
        title: "Funciones Lineales",
        category: "Funciones",
        icon: "üìà",
        status: "completed",
        progress: 100,
        stars: 3,
        points: 300,
        description: "Entiende el comportamiento lineal"
    }
];

        // Sincroniza los juegos del curso con los datos del usuario
function syncUserGamesWithGrade() {
    const gradeGames = gradeContent[studentData.grade].games;
    if (!metrics.games) metrics.games = [];

    // Para cada juego del grado, verifica si existe en metrics.games, si no, lo agrega como nuevo
    gradeGames.forEach(game => {
        let userGame = metrics.games.find(g => g.title === game.title);
        if (!userGame) {
            metrics.games.push({
                title: game.title,
                status: 'new',
                progress: 0,
                stars: 0
            });
        }
    });

    // Opcional: elimina juegos que ya no est√°n en el grado actual
    metrics.games = metrics.games.filter(g => gradeGames.some(game => game.title === g.title));

    // Guarda los cambios en LocalStorage
    let usersDB = JSON.parse(localStorage.getItem('usersDB') || '[]');
    const userIndex = usersDB.findIndex(u => u.email === user.email);
    if (userIndex !== -1) {
        usersDB[userIndex].metrics.games = metrics.games;
        localStorage.setItem('usersDB', JSON.stringify(usersDB));
        localStorage.setItem('currentUser', JSON.stringify(usersDB[userIndex]));
    }
}

        // Generar el calendario de racha
        function generateStreakCalendar() {
            const calendar = document.getElementById('streakCalendar');
            const today = new Date();
            const days = ['D', 'L', 'M', 'M', 'J', 'V', 'S'];
            
            // Agregar encabezados de d√≠as
            days.forEach(day => {
                const dayElement = document.createElement('div');
                dayElement.textContent = day;
                dayElement.style.fontSize = '0.7rem';
                dayElement.style.color = '#64748b';
                dayElement.style.fontWeight = 'bold';
                calendar.appendChild(dayElement);
            });
            
            // Generar √∫ltimos 14 d√≠as
            for (let i = 13; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = date.getDate();
                
                // Simular actividad (√∫ltimos 7 d√≠as activos para la racha)
                if (i < 7) {
                    dayElement.classList.add('active');
                }
                
                if (i === 0) {
                    dayElement.classList.add('today');
                }
                
                calendar.appendChild(dayElement);
            }
        }

        // Renderizar tem√°ticas y juegos seg√∫n el grado
function renderTopicsAndGames(grade) {
    const content = gradeContent[grade];
    if (!content) return;

    // Tem√°ticas
    const welcomeSection = document.querySelector('.welcome-section .welcome-content');
    let topicsHtml = `<h3 style="margin-top:2rem;color:#fbbf24;">Tem√°ticas principales</h3><ul style="margin:1rem 0 2rem 1.5rem;color:#fbbf24;">`;
    content.topics.forEach(topic => {
        topicsHtml += `<li>${topic}</li>`;
    });
    topicsHtml += `</ul>`;
    welcomeSection.insertAdjacentHTML('beforeend', topicsHtml);

    // Juegos
    const gamesGrid = document.getElementById('gamesGrid');
    gamesGrid.innerHTML = '';
    content.games.forEach((game, index) => {
        // Buscar progreso y estado del juego por t√≠tulo en los datos reales del usuario
        const userGame = (metrics.games || []).find(g => g.title === game.title);

        let statusClass = 'status-new', statusText = 'Nuevo', progress = 0, stars = 0;
        if (userGame) {
            statusClass = `status-${userGame.status}`;
            statusText = {
                'new': 'Nuevo',
                'progress': 'En Progreso',
                'completed': 'Completado',
                'locked': 'Bloqueado'
            }[userGame.status];
            progress = userGame.progress;
            stars = userGame.stars;
        }

        let starsHtml = '';
        for (let i = 0; i < 3; i++) {
            starsHtml += `<span class="star ${i < stars ? '' : 'empty'}">‚òÖ</span>`;
        }

        let buttonText = 'Jugar';
        let buttonDisabled = '';
        if (userGame && userGame.status === 'locked') {
            buttonText = 'Bloqueado';
            buttonDisabled = 'disabled';
        } else if (userGame && userGame.status === 'progress') {
            buttonText = 'Continuar';
        } else if (userGame && userGame.status === 'completed') {
            buttonText = 'Jugar de Nuevo';
        }

        gamesGrid.innerHTML += `
            <div class="game-card" style="animation-delay: ${index * 0.1}s">
                <div class="game-header">
                    <div class="game-icon">${game.icon}</div>
                    <div class="game-info">
                        <h3>${game.title}</h3>
                    </div>
                </div>
                <div class="game-progress">
                    <div class="game-status">
                        <span class="status-badge ${statusClass}">${statusText}</span>
                        <div class="stars">${starsHtml}</div>
                    </div>
                    ${progress > 0 ? `
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progress}%;"></div>
                        </div>
                        <div class="progress-text">${progress}% completado</div>
                    ` : ''}
                    <p style="color: #94a3b8; font-size: 0.9rem; margin: 1rem 0;">${game.description}</p>
                    <button class="play-btn" ${buttonDisabled} onclick="window.location.href='${game.file}'">${buttonText}</button>
                </div>
            </div>
        `;
    });
}

function renderLeaderboard() {
    const leaderboardCard = document.querySelector('.leaderboard-card');
    const usersDB = JSON.parse(localStorage.getItem('usersDB') || '[]');
    // Filtrar por colegio y grado
    const sameGroup = usersDB.filter(u =>
        u.institution === studentData.school &&
        u.grade === studentData.grade &&
        u.metrics && typeof u.metrics.totalPoints === 'number'
    );
    // Ordenar por puntos
    sameGroup.sort((a, b) => b.metrics.totalPoints - a.metrics.totalPoints);

    // Generar HTML del ranking
    let html = '';
    sameGroup.forEach((u, idx) => {
        const isCurrent = u.email === user.email;
        html += `
            <div class="leaderboard-item${isCurrent ? '" style="background: rgba(59, 130, 246, 0.1); border-radius: 8px; margin: 0 -8px; padding-left: 8px; padding-right: 8px;' : ''}">
                <span class="leaderboard-position">#${idx + 1}</span>
                <span class="leaderboard-name">${isCurrent ? 'T√∫ (' + studentData.name + ')' : u.firstName + ' ' + u.lastName[0] + '.'}</span>
                <span class="leaderboard-score">${u.metrics.totalPoints.toLocaleString()} pts</span>
            </div>
        `;
    });

    leaderboardCard.innerHTML = `
        <h3>ü•á Ranking del Grado</h3>
        ${html}
    `;
}

// Llama a la funci√≥n en la inicializaci√≥n
document.addEventListener('DOMContentLoaded', function() {
    // Sincroniza los juegos del usuario con los del grado actual
    syncUserGamesWithGrade();

            // Actualizar datos del usuario en el header
            document.querySelector('.welcome-text h2').textContent = `¬°Hola, ${studentData.name}!`;
            document.querySelector('.welcome-text p').textContent = `${studentData.grade}¬∞ Grado - ${studentData.school}`;
            document.getElementById('userAvatar').textContent = studentData.avatar;

            // Actualizar badge de grado
            document.querySelector('.grade-badge').textContent = `${studentData.grade}¬∞ Grado`;

            // Progreso real
            document.querySelectorAll('.progress-card')[0].querySelector('.progress-fill').style.width = studentData.progress.algebra + '%';
    document.querySelectorAll('.progress-card')[0].querySelector('.progress-text').textContent = studentData.progress.algebra + '% completado';
    document.querySelectorAll('.progress-card')[1].querySelector('.progress-fill').style.width = studentData.progress.geometria + '%';
    document.querySelectorAll('.progress-card')[1].querySelector('.progress-text').textContent = studentData.progress.geometria + '% completado';
    document.querySelectorAll('.progress-card')[2].querySelector('.progress-fill').style.width = studentData.progress.estadistica + '%';
    document.querySelectorAll('.progress-card')[2].querySelector('.progress-text').textContent = studentData.progress.estadistica + '% completado';

            // Renderizar tem√°ticas y juegos seg√∫n el grado
renderTopicsAndGames(studentData.grade);
renderLeaderboard();

            // El resto de la inicializaci√≥n...
            generateStreakCalendar();
            setTimeout(() => { animateCounters(); }, 500);
            createMathParticles();
            setInterval(createMathParticles, 12000);
            setTimeout(() => { showNotification(`¬°Bienvenida de vuelta, ${studentData.name}! üåü`, 'success'); }, 1000);
            setTimeout(() => { showNotification('üèÜ ¬°Nuevo logro desbloocado: Estudiante Constante!', 'success'); }, 5000);
        });

        // Easter egg: Konami code
        let konamiCode = [];
        const konamiSequence = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'KeyB', 'KeyA'];

        document.addEventListener('keydown', function(e) {
            konamiCode.push(e.code);
            if (konamiCode.length > konamiSequence.length) {
                konamiCode.shift();
            }
            
            if (konamiCode.length === konamiSequence.length && 
                konamiCode.every((code, index) => code === konamiSequence[index])) {
                
                // Easter egg activado
                document.body.style.animation = 'rainbow 2s infinite';
                showNotification('üéâ ¬°C√≥digo secreto activado! Modo arco√≠ris ON', 'success');
                
                const rainbowStyle = `
                    @keyframes rainbow {
                        0% { filter: hue-rotate(0deg); }
                        100% { filter: hue-rotate(360deg); }
                    }
                `;
                
                const rainbowSheet = document.createElement('style');
                rainbowSheet.textContent = rainbowStyle;
                document.head.appendChild(rainbowSheet);
                
                setTimeout(() => {
                    document.body.style.animation = '';
                    document.head.removeChild(rainbowSheet);
                    showNotification('Modo normal restaurado ‚ú®', 'info');
                }, 10000);
                
                konamiCode = [];
            }
        });

        console.log('üéÆ Dashboard del estudiante cargado exitosamente');
        console.log('üí° Tip: Intenta el c√≥digo Konami para una sorpresa...');
    </script>
</body>
</html>