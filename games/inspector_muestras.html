<!DOCTYPE html>
<html lang="es">
<head>
      <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XZ1QWD1TCC"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XZ1QWD1TCC');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inspector de Muestras - Grado 10¬∞</title>
    
  <link rel="stylesheet" href="/assets/css/games/inspector_muestras.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî¨ Inspector de Muestras</h1>
            <p>Aprende estad√≠stica inferencial analizando poblaciones y muestras</p>
            <div class="stats-bar">
                <div class="stat">üéØ Nivel: <span id="level">1</span></div>
                <div class="stat">‚≠ê Puntos: <span id="points">0</span></div>
                <div class="stat">üß™ Experimentos: <span id="experiments">0</span></div>
                <div class="stat">üèÜ Aciertos: <span id="correct">0</span>/5</div>
            </div>
        </div>
        
        <div class="main-layout">
            <div class="sidebar">
                <h3>üéØ Escenarios de Investigaci√≥n</h3>
                <div class="scenario-selector" id="scenarios">
                    <!-- Los escenarios se generar√°n con JavaScript -->
                </div>
                
                <div class="sampling-controls">
                    <h4 style="color: #2d3748; margin-bottom: 15px; text-align: center;">‚öôÔ∏è Configuraci√≥n de Muestra</h4>
                    
                    <div class="control-group">
                        <label class="control-label">Tama√±o de Muestra (n)</label>
                        <input type="range" class="control-input" id="sampleSize" min="10" max="200" value="30">
                        <div style="text-align: center; color: #4a5568; font-weight: bold; margin-top: 5px;">
                            n = <span id="sampleSizeValue">30</span>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Nivel de Confianza</label>
                        <select class="control-input" id="confidenceLevel">
                            <option value="90">90%</option>
                            <option value="95" selected>95%</option>
                            <option value="99">99%</option>
                        </select>
                    </div>
                    
                    <button class="btn" onclick="takeSample()">üé≤ Tomar Muestra</button>
                </div>
            </div>
            
            <div class="lab-area">
                <h2>üß™ Laboratorio Estad√≠stico</h2>
                
                <div class="population-display">
                    <h3 style="color: #2d3748; margin-bottom: 15px;">üë• Poblaci√≥n Objetivo</h3>
                    <div id="populationDescription">
                        Selecciona un escenario de investigaci√≥n para comenzar
                    </div>
                    <div class="population-info" id="populationInfo">
                        <!-- Se llenar√° con JavaScript -->
                    </div>
                </div>
                
                <div class="sample-display" id="sampleDisplay" style="display: none;">
                    <h3 style="color: #744210; margin-bottom: 15px; text-align: center;">üìã Muestra Obtenida</h3>
                    <div class="sample-points" id="samplePoints">
                        <!-- Se llenar√° con JavaScript -->
                    </div>
                </div>
                
                <div class="chart-container" id="chartContainer" style="display: none;">
                    <h4 style="color: #2d3748; text-align: center; margin-bottom: 15px;">üìä Distribuci√≥n de la Muestra</h4>
                    <div class="histogram" id="histogram">
                        <!-- Se generar√° con JavaScript -->
                    </div>
                </div>
            </div>
            
            <div class="analysis-panel">
                <h3>üìà An√°lisis Estad√≠stico</h3>
                
                <div class="statistics-summary" id="statisticsSummary" style="display: none;">
                    <h4 style="color: #2d3748; text-align: center; margin-bottom: 15px;">üìã Estad√≠sticas de la Muestra</h4>
                    <div id="sampleStats">
                        <!-- Se llenar√° con JavaScript -->
                    </div>
                    <div class="confidence-interval" id="confidenceInterval">
                        <!-- Se llenar√° con JavaScript -->
                    </div>
                </div>
                
                <div class="problem-section" id="problemSection" style="display: none;">
                    <h4 style="color: #2d3748; text-align: center; margin-bottom: 15px;">üßÆ Pregunta de An√°lisis</h4>
                    <div class="problem-text" id="problemText">
                        <!-- Se llenar√° con JavaScript -->
                    </div>
                    <div class="answer-options" id="answerOptions">
                        <!-- Se llenar√° con JavaScript -->
                    </div>
                    <div class="feedback" id="feedback" style="display: none;">
                        <!-- Se llenar√° con JavaScript -->
                    </div>
                </div>
                
                <button class="btn success" onclick="newExperiment()" style="margin-top: 20px;">üîÑ Nuevo Experimento</button>
            </div>
        </div>
    </div>

    <script>
         // Redirige si no hay usuario autenticado
        if (!localStorage.getItem('currentUser') && !sessionStorage.getItem('currentUser')) {
            window.location.href = "complete-login-html.html";
        }
        // Datos del juego
        let gameData = {
            level: 1,
            points: 0,
            correct: 0,
            experiments: 0,
            currentScenario: null,
            currentSample: null,
            currentProblem: null
        };

        // Escenarios de investigaci√≥n
        const scenarios = [
            {
                id: 'heights',
                title: 'Alturas de Estudiantes',
                description: 'Investiga la altura promedio de estudiantes universitarios',
                population: {
                    mean: 170,
                    stdDev: 8,
                    size: 50000,
                    unit: 'cm',
                    type: 'normal'
                },
                context: 'Una universidad quiere conocer la altura promedio de sus estudiantes para planificar la infraestructura del campus.'
            },
            {
                id: 'scores',
                title: 'Puntajes de Ex√°menes',
                description: 'Analiza el rendimiento acad√©mico en pruebas estandarizadas',
                population: {
                    mean: 75,
                    stdDev: 12,
                    size: 100000,
                    unit: 'puntos',
                    type: 'normal'
                },
                context: 'El Ministerio de Educaci√≥n necesita evaluar el rendimiento acad√©mico nacional en matem√°ticas.'
            },
            {
                id: 'income',
                title: 'Ingresos Familiares',
                description: 'Estudia los ingresos mensuales de las familias colombianas',
                population: {
                    mean: 2500000,
                    stdDev: 800000,
                    size: 15000000,
                    unit: 'pesos',
                    type: 'normal'
                },
                context: 'El DANE requiere estimar el ingreso familiar promedio para pol√≠ticas sociales.'
            },
            {
                id: 'satisfaction',
                title: 'Satisfacci√≥n del Cliente',
                description: 'Eval√∫a la satisfacci√≥n en una escala de 1 a 10',
                population: {
                    mean: 7.2,
                    stdDev: 1.5,
                    size: 25000,
                    unit: '/10',
                    type: 'normal'
                },
                context: 'Una empresa de servicios quiere medir la satisfacci√≥n de sus clientes.'
            }
        ];

        // Valores cr√≠ticos para intervalos de confianza
        const zValues = {
            90: 1.645,
            95: 1.960,
            99: 2.576
        };

        // Preguntas por escenario
        const questions = {
            heights: [
                {
                    text: "Con base en el intervalo de confianza calculado, ¬øqu√© puedes concluir sobre la altura promedio de los estudiantes?",
                    options: [
                        "La altura promedio poblacional est√° definitivamente dentro del intervalo",
                        "Hay un [CONFIDENCE]% de probabilidad de que Œº est√© en el intervalo",
                        "El intervalo siempre contiene la media muestral",
                        "La muestra no es representativa de la poblaci√≥n"
                    ],
                    correct: 1
                },
                {
                    text: "Si aumentamos el tama√±o de la muestra, ¬øqu√© pasar√° con el intervalo de confianza?",
                    options: [
                        "Se har√° m√°s ancho",
                        "Se har√° m√°s estrecho",
                        "No cambiar√°",
                        "Depende de la media muestral"
                    ],
                    correct: 1
                }
            ],
            scores: [
                {
                    text: "El error est√°ndar de la media muestral es [SE]. ¬øQu√© significa esto?",
                    options: [
                        "Es la desviaci√≥n est√°ndar de la poblaci√≥n",
                        "Es la variabilidad esperada de las medias muestrales",
                        "Es el error en cada dato individual",
                        "Es la diferencia entre la media muestral y poblacional"
                    ],
                    correct: 1
                },
                {
                    text: "Si el puntaje promedio nacional real es 78, ¬øest√° dentro de tu intervalo de confianza?",
                    options: [
                        "S√≠, siempre estar√° dentro",
                        "No, nunca estar√° dentro",
                        "Depende del intervalo calculado",
                        "No se puede determinar"
                    ],
                    correct: 2
                }
            ],
            income: [
                {
                    text: "El margen de error de ¬±[ME] pesos significa que:",
                    options: [
                        "Todos los ingresos est√°n en ese rango",
                        "La media poblacional probablemente difiere de la muestral por esa cantidad",
                        "Es el error de medici√≥n de la encuesta",
                        "Es la inflaci√≥n esperada"
                    ],
                    correct: 1
                },
                {
                    text: "¬øPor qu√© es importante usar muestreo para estimar ingresos familiares?",
                    options: [
                        "Es m√°s barato y r√°pido que un censo completo",
                        "Los censos son siempre inexactos",
                        "Las muestras son m√°s precisas",
                        "No hay diferencia entre muestra y censo"
                    ],
                    correct: 0
                }
            ],
            satisfaction: [
                {
                    text: "Tu muestra tiene una media de [MEAN]/10. ¬øQu√© tan confiable es esta estimaci√≥n?",
                    options: [
                        "Es exactamente igual a la media poblacional",
                        "La confiabilidad depende del tama√±o de muestra y variabilidad",
                        "No es confiable porque es solo una muestra",
                        "Es 100% confiable"
                    ],
                    correct: 1
                },
                {
                    text: "Si quisi√©ramos un intervalo de confianza m√°s preciso (m√°s estrecho), podr√≠amos:",
                    options: [
                        "Disminuir el nivel de confianza",
                        "Aumentar el tama√±o de la muestra",
                        "Ambas opciones anteriores",
                        "No se puede hacer m√°s preciso"
                    ],
                    correct: 2
                }
            ]
        };

        // Inicializar el juego
        function initGame() {
            displayScenarios();
            updateStats();
            setupEventListeners();
        }

        // Configurar event listeners
        function setupEventListeners() {
            const sampleSize = document.getElementById('sampleSize');
            const sampleSizeValue = document.getElementById('sampleSizeValue');
            
            sampleSize.addEventListener('input', () => {
                sampleSizeValue.textContent = sampleSize.value;
            });
        }

        // Mostrar escenarios
        function displayScenarios() {
            const container = document.getElementById('scenarios');
            container.innerHTML = '';
            
            scenarios.forEach(scenario => {
                const card = document.createElement('div');
                card.className = 'scenario-card';
                card.onclick = () => selectScenario(scenario.id);
                
                card.innerHTML = `
                    <div class="scenario-title">${scenario.title}</div>
                    <div class="scenario-description">${scenario.description}</div>
                `;
                
                container.appendChild(card);
            });
        }

        // Seleccionar escenario
        function selectScenario(scenarioId) {
            document.querySelectorAll('.scenario-card').forEach(card => {
                card.classList.remove('active');
            });
            
            event.target.closest('.scenario-card').classList.add('active');
            
            gameData.currentScenario = scenarios.find(s => s.id === scenarioId);
            displayPopulation();
            
            // Resetear displays
            document.getElementById('sampleDisplay').style.display = 'none';
            document.getElementById('chartContainer').style.display = 'none';
            document.getElementById('statisticsSummary').style.display = 'none';
            document.getElementById('problemSection').style.display = 'none';
        }

        // Mostrar informaci√≥n de la poblaci√≥n
        function displayPopulation() {
            const scenario = gameData.currentScenario;
            const description = document.getElementById('populationDescription');
            const info = document.getElementById('populationInfo');
            
            description.innerHTML = `
                <h4 style="color: #2d3748; margin-bottom: 10px;">${scenario.title}</h4>
                <p style="color: #4a5568; line-height: 1.5;">${scenario.context}</p>
            `;
            
            info.innerHTML = `
                <div class="info-card">
                    <div class="info-title">Media Poblacional (Œº)</div>
                    <div class="info-value">${formatValue(scenario.population.mean, scenario.population.unit)}</div>
                </div>
                <div class="info-card">
                    <div class="info-title">Desviaci√≥n Est√°ndar (œÉ)</div>
                    <div class="info-value">${formatValue(scenario.population.stdDev, scenario.population.unit)}</div>
                </div>
                <div class="info-card">
                    <div class="info-title">Tama√±o Poblacional (N)</div>
                    <div class="info-value">${scenario.population.size.toLocaleString()}</div>
                </div>
            `;
        }

        // Formatear valores
        function formatValue(value, unit) {
            if (unit === 'pesos') {
                return '$' + Math.round(value).toLocaleString();
            } else if (unit === 'cm') {
                return value.toFixed(1) + ' cm';
            } else if (unit === 'puntos') {
                return value.toFixed(1) + ' pts';
            } else if (unit === '/10') {
                return value.toFixed(1) + '/10';
            }
            return value.toFixed(2);
        }

        // Tomar muestra
        function takeSample() {
            if (!gameData.currentScenario) {
                alert('¬°Selecciona primero un escenario de investigaci√≥n!');
                return;
            }
            
            const sampleSize = parseInt(document.getElementById('sampleSize').value);
            const scenario = gameData.currentScenario;
            
            // Generar muestra aleatoria con distribuci√≥n normal
            const sample = [];
            for (let i = 0; i < sampleSize; i++) {
                const value = generateNormalRandom(scenario.population.mean, scenario.population.stdDev);
                sample.push(Math.max(0, value)); // Asegurar valores positivos
            }
            
            gameData.currentSample = {
                data: sample,
                size: sampleSize,
                scenario: scenario
            };
            
            displaySample();
            calculateStatistics();
            createHistogram();
            generateProblem();
            gameData.experiments++;
            updateStats();
        }

        // Generar n√∫mero aleatorio con distribuci√≥n normal
        function generateNormalRandom(mean, stdDev) {
            let u1 = Math.random();
            let u2 = Math.random();
            let z0 = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
            return z0 * stdDev + mean;
        }

        // Mostrar muestra
        function displaySample() {
            const sampleDisplay = document.getElementById('sampleDisplay');
            const samplePoints = document.getElementById('samplePoints');
            const sample = gameData.currentSample;
            
            sampleDisplay.style.display = 'block';
            
            // Mostrar solo los primeros 50 valores para evitar sobrecarga visual
            const displayData = sample.data.slice(0, 50);
            const remaining = sample.data.length - displayData.length;
            
            samplePoints.innerHTML = displayData.map(value => 
                `<div class="data-point">${formatValue(value, sample.scenario.population.unit)}</div>`
            ).join('') + (remaining > 0 ? `<div class="data-point" style="background: #718096;">+${remaining} m√°s</div>` : '');
        }

        // Calcular estad√≠sticas
        function calculateStatistics() {
            const sample = gameData.currentSample.data;
            const n = sample.length;
            const confidenceLevel = parseInt(document.getElementById('confidenceLevel').value);
            const zValue = zValues[confidenceLevel];
            
            // Estad√≠sticas b√°sicas
            const mean = sample.reduce((sum, val) => sum + val, 0) / n;
            const variance = sample.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / (n - 1);
            const stdDev = Math.sqrt(variance);
            const standardError = stdDev / Math.sqrt(n);
            
            // Intervalo de confianza
            const marginError = zValue * standardError;
            const lowerBound = mean - marginError;
            const upperBound = mean + marginError;
            
            gameData.currentSample.stats = {
                mean, stdDev, standardError, marginError, lowerBound, upperBound, n, confidenceLevel
            };
            
            displayStatistics();
        }

        // Mostrar estad√≠sticas
        function displayStatistics() {
            const stats = gameData.currentSample.stats;
            const unit = gameData.currentSample.scenario.population.unit;
            const summary = document.getElementById('statisticsSummary');
            const sampleStats = document.getElementById('sampleStats');
            const confidenceInterval = document.getElementById('confidenceInterval');
            
            summary.style.display = 'block';
            
            sampleStats.innerHTML = `
                <div class="stat-row">
                    <span class="stat-name">Media Muestral (xÃÑ)</span>
                    <span class="stat-value">${formatValue(stats.mean, unit)}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-name">Desviaci√≥n Est√°ndar (s)</span>
                    <span class="stat-value">${formatValue(stats.stdDev, unit)}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-name">Error Est√°ndar</span>
                    <span class="stat-value">${formatValue(stats.standardError, unit)}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-name">Margen de Error</span>
                    <span class="stat-value">¬±${formatValue(stats.marginError, unit)}</span>
                </div>
            `;
            
            confidenceInterval.innerHTML = `
                Intervalo de Confianza ${stats.confidenceLevel}%<br>
                [${formatValue(stats.lowerBound, unit)}, ${formatValue(stats.upperBound, unit)}]
            `;
        }

        // Crear histograma
        function createHistogram() {
            const container = document.getElementById('chartContainer');
            const histogram = document.getElementById('histogram');
            const sample = gameData.currentSample.data;
            
            container.style.display = 'block';
            
            // Calcular bins
            const bins = 8;
            const min = Math.min(...sample);
            const max = Math.max(...sample);
            const binWidth = (max - min) / bins;
            
            const binCounts = new Array(bins).fill(0);
            const binLabels = [];
            
            // Contar frecuencias
            sample.forEach(value => {
                const binIndex = Math.min(Math.floor((value - min) / binWidth), bins - 1);
                binCounts[binIndex]++;
            });
            
            // Crear etiquetas de bins
            for (let i = 0; i < bins; i++) {
                const binStart = min + i * binWidth;
                binLabels.push(binStart.toFixed(0));
            }
            
            // Crear barras del histograma
            const maxCount = Math.max(...binCounts);
            histogram.innerHTML = '';
            
            binCounts.forEach((count, index) => {
                const bar = document.createElement('div');
                bar.className = 'histogram-bar';
                const height = (count / maxCount) * 200; // Altura m√°xima de 200px
                bar.style.height = height + 'px';
                bar.textContent = count;
                bar.title = `Rango: ${binLabels[index]} - ${(parseFloat(binLabels[index]) + binWidth).toFixed(0)}\nFrecuencia: ${count}`;
                histogram.appendChild(bar);
            });
        }

        // Generar problema
        function generateProblem() {
            const scenarioQuestions = questions[gameData.currentScenario.id];
            const randomQuestion = scenarioQuestions[Math.floor(Math.random() * scenarioQuestions.length)];
            
            // Reemplazar placeholders en el texto
            let questionText = randomQuestion.text;
            const stats = gameData.currentSample.stats;
            const unit = gameData.currentSample.scenario.population.unit;
            
            questionText = questionText.replace('[CONFIDENCE]', stats.confidenceLevel);
            questionText = questionText.replace('[SE]', formatValue(stats.standardError, unit));
            questionText = questionText.replace('[ME]', formatValue(stats.marginError, unit));
            questionText = questionText.replace('[MEAN]', formatValue(stats.mean, unit));
            
            gameData.currentProblem = {
                ...randomQuestion,
                processedText: questionText
            };
            
            displayProblem();
        }

        // Mostrar problema
        function displayProblem() {
            const problemSection = document.getElementById('problemSection');
            const problemText = document.getElementById('problemText');
            const answerOptions = document.getElementById('answerOptions');
            const feedback = document.getElementById('feedback');
            
            problemSection.style.display = 'block';
            feedback.style.display = 'none';
            
            problemText.textContent = gameData.currentProblem.processedText;
            
            answerOptions.innerHTML = '';
            gameData.currentProblem.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'answer-option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => selectAnswer(index);
                answerOptions.appendChild(optionDiv);
            });
        }

        // Seleccionar respuesta
        function selectAnswer(selectedIndex) {
            const options = document.querySelectorAll('.answer-option');
            const feedback = document.getElementById('feedback');
            const correctIndex = gameData.currentProblem.correct;
            
            // Remover selecciones anteriores
            options.forEach(option => {
                option.classList.remove('selected', 'correct', 'incorrect');
            });
            
            // Marcar la opci√≥n seleccionada
            options[selectedIndex].classList.add('selected');
            
            // Mostrar todas las respuestas correctas e incorrectas
            options.forEach((option, index) => {
                if (index === correctIndex) {
                    option.classList.add('correct');
                } else {
                    option.classList.add('incorrect');
                }
            });
            
            // Mostrar feedback
            feedback.style.display = 'block';
            if (selectedIndex === correctIndex) {
                feedback.className = 'feedback correct';
                feedback.innerHTML = '¬°Correcto! üéâ<br>Has demostrado una buena comprensi√≥n de la estad√≠stica inferencial.';
                gameData.points += 20;
                gameData.correct++;
            } else {
                feedback.className = 'feedback incorrect';
                feedback.innerHTML = 'Incorrecto. üòî<br>Revisa los conceptos de intervalos de confianza y estad√≠stica inferencial.';
                gameData.points += 5;
            }
            
            updateStats();
            
            // Verificar si ha completado 5 preguntas
            if (gameData.correct >= 5) {
                setTimeout(() => {
                    alert('¬°Felicitaciones! Has completado el nivel 1. üèÜ\n\n¬°Sigue practicando para dominar la estad√≠stica inferencial!');
                    gameData.level++;
                    gameData.correct = 0;
                    updateStats();
                }, 1500);
            }
        }

        // Nuevo experimento
        function newExperiment() {
            // Resetear displays
            document.getElementById('sampleDisplay').style.display = 'none';
            document.getElementById('chartContainer').style.display = 'none';
            document.getElementById('statisticsSummary').style.display = 'none';
            document.getElementById('problemSection').style.display = 'none';
            
            // Limpiar datos actuales
            gameData.currentSample = null;
            gameData.currentProblem = null;
            
            // Mensaje motivacional
            const messages = [
                '¬°Excelente! üî¨ Sigue experimentando para dominar la estad√≠stica.',
                '¬°Muy bien! üìä Cada muestra te ense√±a algo nuevo.',
                '¬°Fant√°stico! üìà La pr√°ctica hace al maestro estad√≠stico.',
                '¬°Incre√≠ble! üß™ Est√°s desarrollando intuici√≥n estad√≠stica.',
                '¬°Genial! üéØ Sigue explorando diferentes escenarios.'
            ];
            
            const randomMessage = messages[Math.floor(Math.random() * messages.length)];
            
            // Mostrar mensaje temporal
            const tempMessage = document.createElement('div');
            tempMessage.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #48bb78, #38a169);
                color: white;
                padding: 20px 40px;
                border-radius: 15px;
                font-weight: bold;
                font-size: 1.2rem;
                z-index: 10000;
                box-shadow: 0 10px 25px rgba(72, 187, 120, 0.3);
                animation: fadeInOut 2s ease-in-out;
            `;
            tempMessage.textContent = randomMessage;
            document.body.appendChild(tempMessage);
            
            setTimeout(() => {
                tempMessage.remove();
            }, 2000);
        }

        // Actualizar estad√≠sticas
        function updateStats() {
            document.getElementById('level').textContent = gameData.level;
            document.getElementById('points').textContent = gameData.points;
            document.getElementById('experiments').textContent = gameData.experiments;
            document.getElementById('correct').textContent = gameData.correct;
        }

        // Inicializar cuando la p√°gina carga
        window.addEventListener('load', initGame);
    </script>
    
    
</body>
</html>