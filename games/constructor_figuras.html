<!DOCTYPE html>
<html lang="es">
<head>
     <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XZ1QWD1TCC"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XZ1QWD1TCC');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Constructor de Figuras - Grado 6¬∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .geometric-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 15% 25%, rgba(255, 193, 7, 0.2) 0%, transparent 40%),
                radial-gradient(circle at 85% 75%, rgba(40, 167, 69, 0.2) 0%, transparent 40%),
                radial-gradient(circle at 50% 10%, rgba(220, 53, 69, 0.15) 0%, transparent 30%);
            animation: geometricFloat 20s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes geometricFloat {
            0%, 100% { transform: scale(1) rotate(0deg); opacity: 0.8; }
            33% { transform: scale(1.05) rotate(1deg); opacity: 1; }
            66% { transform: scale(0.95) rotate(-1deg); opacity: 0.9; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 10;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .header h1 {
            font-size: 3.5rem;
            background: linear-gradient(45deg, #ffc107, #28a745, #dc3545, #17a2b8);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 40px rgba(255, 193, 7, 0.5);
            margin-bottom: 10px;
            animation: constructorGlow 4s ease-in-out infinite;
        }

        @keyframes constructorGlow {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(255, 193, 7, 0.8)); }
            25% { filter: drop-shadow(0 0 30px rgba(40, 167, 69, 0.8)); }
            50% { filter: drop-shadow(0 0 25px rgba(220, 53, 69, 0.8)); }
            75% { filter: drop-shadow(0 0 30px rgba(23, 162, 184, 0.8)); }
        }

        .subtitle {
            font-size: 1.3rem;
            color: #ddd;
            margin-bottom: 20px;
        }

        .game-mode-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .mode-btn {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.3), rgba(40, 167, 69, 0.2));
            border: 2px solid rgba(255, 193, 7, 0.4);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #ffc107, #28a745);
            box-shadow: 0 0 25px rgba(255, 193, 7, 0.6);
            transform: scale(1.05);
        }

        .mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 193, 7, 0.4);
        }

        .main-workspace {
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 30px;
            margin-bottom: 30px;
            min-height: 600px;
        }

        .tools-panel {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05));
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(10px);
        }

        .canvas-area {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            position: relative;
            backdrop-filter: blur(15px);
            overflow: hidden;
        }

        .canvas-container {
            width: 100%;
            height: 100%;
            position: relative;
            background: 
                linear-gradient(90deg, rgba(255,255,255,0.1) 1px, transparent 1px),
                linear-gradient(rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        #constructorCanvas {
            width: 100%;
            height: 100%;
            border-radius: 17px;
            cursor: crosshair;
        }

        .info-panel {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05));
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(10px);
        }

        .panel-title {
            font-size: 1.5rem;
            color: #ffc107;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 0 15px rgba(255, 193, 7, 0.8);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .shape-tools {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .shape-btn {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.2);
            padding: 15px 10px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            text-align: center;
            font-size: 0.9rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .shape-btn.active {
            background: linear-gradient(135deg, #ffc107, #28a745);
            box-shadow: 0 0 20px rgba(255, 193, 7, 0.6);
            transform: scale(1.05);
        }

        .shape-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(23, 162, 184, 0.4);
        }

        .shape-icon {
            font-size: 2rem;
        }

        .measurement-controls {
            margin-bottom: 25px;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-label {
            display: block;
            color: #ffc107;
            font-weight: bold;
            margin-bottom: 8px;
            text-shadow: 0 0 10px rgba(255, 193, 7, 0.6);
        }

        .control-input {
            width: 100%;
            padding: 10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-weight: bold;
            backdrop-filter: blur(5px);
        }

        .control-input:focus {
            outline: none;
            border-color: #ffc107;
            box-shadow: 0 0 15px rgba(255, 193, 7, 0.4);
        }

        .color-palette {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .color-btn {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .color-btn.active {
            border-color: white;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
            transform: scale(1.1);
        }

        .color-btn:hover {
            transform: scale(1.05);
        }

        .results-display {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(255, 193, 7, 0.4);
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            color: #17a2b8;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(23, 162, 184, 0.6);
        }

        .result-value {
            color: #28a745;
            font-weight: bold;
            font-size: 1.2rem;
            text-shadow: 0 0 10px rgba(40, 167, 69, 0.8);
        }

        .challenge-panel {
            background: linear-gradient(135deg, rgba(220, 53, 69, 0.2), rgba(255, 193, 7, 0.1));
            border: 2px solid rgba(220, 53, 69, 0.4);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .challenge-title {
            font-size: 1.3rem;
            color: #dc3545;
            margin-bottom: 15px;
            text-shadow: 0 0 15px rgba(220, 53, 69, 0.8);
            font-weight: bold;
        }

        .challenge-description {
            font-size: 1.1rem;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .challenge-target {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            font-size: 1.2rem;
            color: #ffc107;
            font-weight: bold;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin: 20px 0;
        }

        .btn {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            flex: 1;
        }

        .btn-primary {
            background: linear-gradient(135deg, #17a2b8, #138496);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745, #1e7e34);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107, #e0a800);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545, #bd2130);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: rgba(255, 193, 7, 0.6);
        }

        .stat-icon {
            font-size: 2rem;
            margin-bottom: 8px;
            display: block;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffc107;
            margin-bottom: 5px;
            text-shadow: 0 0 10px rgba(255, 193, 7, 0.6);
        }

        .stat-label {
            color: #ddd;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            border-radius: 10px;
            transition: width 0.8s ease;
            box-shadow: 0 0 15px rgba(40, 167, 69, 0.6);
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .tooltip.show {
            opacity: 1;
        }

        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .tutorial-content {
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 40px;
            border-radius: 20px;
            max-width: 600px;
            text-align: center;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.5);
        }

        .tutorial-step {
            display: none;
        }

        .tutorial-step.active {
            display: block;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            font-weight: bold;
            z-index: 1500;
            animation: slideInRight 0.5s ease;
            max-width: 300px;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification-success {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }

        .notification-error {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
        }

        .notification-info {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
        }

        .sound-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #6c757d, #495057);
            border: none;
            color: white;
            padding: 15px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 1501;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .sound-toggle:hover {
            transform: scale(1.1);
        }

        @media (max-width: 1200px) {
            .main-workspace {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .tools-panel, .info-panel {
                order: 2;
            }

            .canvas-area {
                order: 1;
                height: 400px;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5rem;
            }

            .shape-tools {
                grid-template-columns: 1fr;
            }

            .color-palette {
                grid-template-columns: repeat(6, 1fr);
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .formula-display {
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid rgba(255, 193, 7, 0.4);
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
        }

        .formula-title {
            color: #ffc107;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }

        .formula-text {
            text-align: center;
            font-size: 1.2rem;
            color: #17a2b8;
            text-shadow: 0 0 10px rgba(23, 162, 184, 0.6);
        }

        .shape-info {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .measurements-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }

        .measurement-input {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .measurement-input label {
            font-size: 0.9rem;
            color: #17a2b8;
            font-weight: bold;
        }

        .measurement-input input {
            padding: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-weight: bold;
        }

        .achievement {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, #ffc107, #28a745);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            z-index: 2000;
            font-size: 1.5rem;
            font-weight: bold;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.5);
            animation: achievementPop 2s ease;
        }

        @keyframes achievementPop {
            0% { transform: translate(-50%, -50%) scale(0); }
            20% { transform: translate(-50%, -50%) scale(1.2); }
            40% { transform: translate(-50%, -50%) scale(1); }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="geometric-background"></div>
    
    <button class="sound-toggle" onclick="toggleSound()" id="soundToggle">üîä</button>
    
    <div class="container">
        <div class="header">
            <h1>üèóÔ∏è CONSTRUCTOR DE FIGURAS</h1>
            <p class="subtitle">¬°Construye figuras geom√©tricas y calcula per√≠metros y √°reas!</p>
            
            <div class="game-mode-selector">
                <button class="mode-btn active" onclick="setGameMode('construccion')">üî® Construcci√≥n Libre</button>
                <button class="mode-btn" onclick="setGameMode('desafio')">üéØ Desaf√≠os</button>
                <button class="mode-btn" onclick="setGameMode('tutorial')">üìö Tutorial</button>
            </div>
        </div>

        <!-- Panel de Estad√≠sticas -->
        <div class="stats-grid">
            <div class="stat-card">
                <span class="stat-icon">üìê</span>
                <div class="stat-value" id="figuresCreated">0</div>
                <div class="stat-label">Figuras Creadas</div>
            </div>
            <div class="stat-card">
                <span class="stat-icon">üéØ</span>
                <div class="stat-value" id="challengesCompleted">0</div>
                <div class="stat-label">Desaf√≠os Completados</div>
            </div>
            <div class="stat-card">
                <span class="stat-icon">üìè</span>
                <div class="stat-value" id="totalPerimeter">0</div>
                <div class="stat-label">Per√≠metro Total</div>
            </div>
            <div class="stat-card">
                <span class="stat-icon">üìä</span>
                <div class="stat-value" id="totalArea">0</div>
                <div class="stat-label">√Årea Total</div>
            </div>
            <div class="stat-card">
                <span class="stat-icon">‚≠ê</span>
                <div class="stat-value" id="totalScore">0</div>
                <div class="stat-label">Puntuaci√≥n</div>
            </div>
        </div>

        <!-- √Årea de Trabajo Principal -->
        <div class="main-workspace">
            <!-- Panel de Herramientas -->
            <div class="tools-panel">
                <h3 class="panel-title">üõ†Ô∏è Herramientas</h3>
                
                <div class="shape-tools">
                    <button class="shape-btn active" onclick="selectShape('rectangle')" data-shape="rectangle">
                        <span class="shape-icon">‚¨ú</span>
                        <span>Rect√°ngulo</span>
                    </button>
                    <button class="shape-btn" onclick="selectShape('square')" data-shape="square">
                        <span class="shape-icon">üü¶</span>
                        <span>Cuadrado</span>
                    </button>
                    <button class="shape-btn" onclick="selectShape('triangle')" data-shape="triangle">
                        <span class="shape-icon">üî∫</span>
                        <span>Tri√°ngulo</span>
                    </button>
                    <button class="shape-btn" onclick="selectShape('circle')" data-shape="circle">
                        <span class="shape-icon">üîµ</span>
                        <span>C√≠rculo</span>
                    </button>
                </div>

                <div class="measurement-controls">
                    <div class="control-group">
                        <label class="control-label">Ancho/Radio:</label>
                        <input type="number" id="widthInput" class="control-input" min="1" max="20" value="5" onchange="updateMeasurements()">
                    </div>
                    <div class="control-group">
                        <label class="control-label">Alto:</label>
                        <input type="number" id="heightInput" class="control-input" min="1" max="20" value="3" onchange="updateMeasurements()">
                    </div>
                </div>

                <div class="color-palette">
                    <div class="color-btn active" style="background: #ff6b6b;" onclick="selectColor('#ff6b6b')" data-color="#ff6b6b"></div>
                    <div class="color-btn" style="background: #4ecdc4;" onclick="selectColor('#4ecdc4')" data-color="#4ecdc4"></div>
                    <div class="color-btn" style="background: #45b7d1;" onclick="selectColor('#45b7d1')" data-color="#45b7d1"></div>
                    <div class="color-btn" style="background: #96ceb4;" onclick="selectColor('#96ceb4')" data-color="#96ceb4"></div>
                    <div class="color-btn" style="background: #feca57;" onclick="selectColor('#feca57')" data-color="#feca57"></div>
                    <div class="color-btn" style="background: #ff9ff3;" onclick="selectColor('#ff9ff3')" data-color="#ff9ff3"></div>
                    <div class="color-btn" style="background: #54a0ff;" onclick="selectColor('#54a0ff')" data-color="#54a0ff"></div>
                    <div class="color-btn" style="background: #5f27cd;" onclick="selectColor('#5f27cd')" data-color="#5f27cd"></div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="createShape()">Crear Figura</button>
                    <button class="btn btn-danger" onclick="clearCanvas()">Limpiar</button>
                </div>

                <div class="formula-display" id="formulaDisplay">
                    <div class="formula-title">F√≥rmula Actual</div>
                    <div class="formula-text" id="formulaText">
                        Per√≠metro: 2(a + b)<br>
                        √Årea: a √ó b
                    </div>
                </div>
            </div>

            <!-- √Årea del Canvas -->
            <div class="canvas-area">
                <div class="canvas-container">
                    <canvas id="constructorCanvas" width="800" height="600"></canvas>
                </div>
            </div>

            <!-- Panel de Informaci√≥n -->
            <div class="info-panel">
                <h3 class="panel-title">üìä Resultados</h3>
                
                <div class="results-display">
                    <div class="result-item">
                        <span class="result-label">Per√≠metro:</span>
                        <span class="result-value" id="currentPerimeter">0</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">√Årea:</span>
                        <span class="result-value" id="currentArea">0</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Figura:</span>
                        <span class="result-value" id="currentShape">Rect√°ngulo</span>
                    </div>
                </div>

                <div class="challenge-panel" id="challengePanel" style="display: none;">
                    <div class="challenge-title">üéØ Desaf√≠o Actual</div>
                    <div class="challenge-description" id="challengeDescription">
                        Crea un rect√°ngulo con √°rea de 20 unidades cuadradas
                    </div>
                    <div class="challenge-target" id="challengeTarget">
                        Meta: √Årea = 20
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="challengeProgress" style="width: 0%"></div>
                    </div>
                    <button class="btn btn-warning" onclick="newChallenge()">Nuevo Desaf√≠o</button>
                </div>

                <div class="shape-info">
                    <h4 style="color: #ffc107; margin-bottom: 10px;">üìã Informaci√≥n de la Figura</h4>
                    <div id="shapeDetails">
                        Selecciona una herramienta y ajusta las medidas para comenzar.
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-success" onclick="calculateAll()">üìä Calcular Todo</button>
                    <button class="btn btn-warning" onclick="showHint()">üí° Pista</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Tutorial Overlay -->
    <div class="tutorial-overlay" id="tutorialOverlay">
        <div class="tutorial-content">
            <div class="tutorial-step active" id="step1">
                <h2>¬°Bienvenido al Constructor de Figuras! üèóÔ∏è</h2>
                <p>Aqu√≠ aprender√°s a calcular per√≠metros y √°reas de diferentes figuras geom√©tricas.</p>
                <button class="btn btn-primary" onclick="nextTutorialStep()">Continuar</button>
            </div>
            <div class="tutorial-step" id="step2">
                <h2>Herramientas de Construcci√≥n üõ†Ô∏è</h2>
                <p>En el panel izquierdo puedes seleccionar diferentes figuras: rect√°ngulos, cuadrados, tri√°ngulos y c√≠rculos.</p>
                <button class="btn btn-primary" onclick="nextTutorialStep()">Continuar</button>
            </div>
            <div class="tutorial-step" id="step3">
                <h2>Medidas y C√°lculos üìè</h2>
                <p>Ajusta las medidas y observa c√≥mo cambian autom√°ticamente el per√≠metro y el √°rea de tu figura.</p>
                <button class="btn btn-primary" onclick="nextTutorialStep()">Continuar</button>
            </div>
            <div class="tutorial-step" id="step4">
                <h2>¬°Comienza a Construir! üéØ</h2>
                <p>Usa el bot√≥n "Crear Figura" para dibujar en el canvas y completar desaf√≠os matem√°ticos.</p>
                <button class="btn btn-success" onclick="closeTutorial()">¬°Empezar!</button>
            </div>
        </div>
    </div>

    <!-- Tooltip -->
    <div class="tooltip" id="tooltip"></div>

    <script>
        // Redirige si no hay usuario autenticado
        if (!localStorage.getItem('currentUser') && !sessionStorage.getItem('currentUser')) {
            window.location.href = "complete-login-html.html";
        }
        // Variables globales del juego
        let gameState = {
            mode: 'construccion',
            currentShape: 'rectangle',
            currentColor: '#ff6b6b',
            soundEnabled: true,
            canvas: null,
            ctx: null,
            shapes: [],
            stats: {
                figuresCreated: 0,
                challengesCompleted: 0,
                totalPerimeter: 0,
                totalArea: 0,
                totalScore: 0
            },
            currentChallenge: null,
            tutorialStep: 0
        };

        // Inicializar el juego
        function initGame() {
            gameState.canvas = document.getElementById('constructorCanvas');
            gameState.ctx = gameState.canvas.getContext('2d');
            
            // Configurar canvas
            setupCanvas();
            
            // Actualizar interfaz inicial
            updateMeasurements();
            updateStats();
            
            // Configurar eventos
            setupEventListeners();
            
            showNotification('¬°Bienvenido al Constructor de Figuras!', 'success');
        }

        function setupCanvas() {
            const canvas = gameState.canvas;
            const container = canvas.parentElement;
            
            // Hacer el canvas responsivo
            function resizeCanvas() {
                const rect = container.getBoundingClientRect();
                canvas.width = rect.width - 20;
                canvas.height = rect.height - 20;
                redrawCanvas();
            }
            
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // Configurar estilo del canvas
            gameState.ctx.lineCap = 'round';
            gameState.ctx.lineJoin = 'round';
            gameState.ctx.textAlign = 'center';
            gameState.ctx.textBaseline = 'middle';
        }

        function setupEventListeners() {
            // Eventos del canvas
            gameState.canvas.addEventListener('click', handleCanvasClick);
            gameState.canvas.addEventListener('mousemove', handleCanvasMouseMove);
            
            // Eventos de inputs
            document.getElementById('widthInput').addEventListener('input', updateMeasurements);
            document.getElementById('heightInput').addEventListener('input', updateMeasurements);
        }

        // Gesti√≥n de formas geom√©tricas
        const shapeDefinitions = {
            rectangle: {
                name: 'Rect√°ngulo',
                icon: '‚¨ú',
                needsHeight: true,
                perimeter: (w, h) => 2 * (w + h),
                area: (w, h) => w * h,
                formula: 'Per√≠metro: 2(a + b)<br>√Årea: a √ó b'
            },
            square: {
                name: 'Cuadrado',
                icon: 'üü¶',
                needsHeight: false,
                perimeter: (w) => 4 * w,
                area: (w) => w * w,
                formula: 'Per√≠metro: 4a<br>√Årea: a¬≤'
            },
            triangle: {
                name: 'Tri√°ngulo',
                icon: 'üî∫',
                needsHeight: true,
                perimeter: (w, h) => w + 2 * Math.sqrt((w/2) * (w/2) + h * h),
                area: (w, h) => (w * h) / 2,
                formula: 'Per√≠metro: a + 2‚àö((a/2)¬≤ + h¬≤)<br>√Årea: (b √ó h) / 2'
            },
            circle: {
                name: 'C√≠rculo',
                icon: 'üîµ',
                needsHeight: false,
                perimeter: (r) => 2 * Math.PI * r,
                area: (r) => Math.PI * r * r,
                formula: 'Per√≠metro: 2œÄr<br>√Årea: œÄr¬≤'
            }
        };

        // Selecci√≥n de forma
        function selectShape(shape) {
            gameState.currentShape = shape;
            
            // Actualizar botones activos
            document.querySelectorAll('.shape-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-shape="${shape}"]`).classList.add('active');
            
            // Actualizar controles
            const heightInput = document.getElementById('heightInput');
            const heightGroup = heightInput.parentElement;
            
            if (shapeDefinitions[shape].needsHeight) {
                heightGroup.style.display = 'block';
                document.querySelector('label[for="widthInput"]').textContent = 
                    shape === 'circle' ? 'Radio:' : shape === 'triangle' ? 'Base:' : 'Ancho:';
            } else {
                heightGroup.style.display = 'none';
                document.querySelector('label[for="widthInput"]').textContent = 
                    shape === 'square' ? 'Lado:' : shape === 'circle' ? 'Radio:' : 'Ancho:';
            }
            
            updateMeasurements();
        }

        // Selecci√≥n de color
        function selectColor(color) {
            gameState.currentColor = color;
            
            // Actualizar botones activos
            document.querySelectorAll('.color-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-color="${color}"]`).classList.add('active');
        }

        // Actualizar medidas y c√°lculos
        function updateMeasurements() {
            const width = parseFloat(document.getElementById('widthInput').value) || 0;
            const height = parseFloat(document.getElementById('heightInput').value) || 0;
            const shape = shapeDefinitions[gameState.currentShape];
            
            let perimeter, area;
            
            if (shape.needsHeight) {
                perimeter = shape.perimeter(width, height);
                area = shape.area(width, height);
            } else {
                perimeter = shape.perimeter(width);
                area = shape.area(width);
            }
            
            // Actualizar display
            document.getElementById('currentPerimeter').textContent = perimeter.toFixed(2);
            document.getElementById('currentArea').textContent = area.toFixed(2);
            document.getElementById('currentShape').textContent = shape.name;
            document.getElementById('formulaText').innerHTML = shape.formula;
            
            // Actualizar informaci√≥n detallada
            updateShapeDetails(width, height, perimeter, area);
        }

        function updateShapeDetails(width, height, perimeter, area) {
            const shape = shapeDefinitions[gameState.currentShape];
            let details = `<strong>${shape.name}</strong><br>`;
            
            switch (gameState.currentShape) {
                case 'rectangle':
                    details += `Ancho: ${width}<br>Alto: ${height}<br>`;
                    details += `C√°lculo del per√≠metro: 2(${width} + ${height}) = ${perimeter.toFixed(2)}<br>`;
                    details += `C√°lculo del √°rea: ${width} √ó ${height} = ${area.toFixed(2)}`;
                    break;
                case 'square':
                    details += `Lado: ${width}<br>`;
                    details += `C√°lculo del per√≠metro: 4 √ó ${width} = ${perimeter.toFixed(2)}<br>`;
                    details += `C√°lculo del √°rea: ${width}¬≤ = ${area.toFixed(2)}`;
                    break;
                case 'triangle':
                    details += `Base: ${width}<br>Altura: ${height}<br>`;
                    details += `C√°lculo del √°rea: (${width} √ó ${height}) √∑ 2 = ${area.toFixed(2)}<br>`;
                    details += `Per√≠metro (tri√°ngulo is√≥sceles): ${perimeter.toFixed(2)}`;
                    break;
                case 'circle':
                    details += `Radio: ${width}<br>`;
                    details += `C√°lculo del per√≠metro: 2œÄ √ó ${width} = ${perimeter.toFixed(2)}<br>`;
                    details += `C√°lculo del √°rea: œÄ √ó ${width}¬≤ = ${area.toFixed(2)}`;
                    break;
            }
            
            document.getElementById('shapeDetails').innerHTML = details;
        }

        // Crear forma en el canvas
        function createShape() {
            const width = parseFloat(document.getElementById('widthInput').value) || 0;
            const height = parseFloat(document.getElementById('heightInput').value) || 0;
            
            if (width <= 0 || (shapeDefinitions[gameState.currentShape].needsHeight && height <= 0)) {
                showNotification('Por favor ingresa medidas v√°lidas', 'error');
                return;
            }
            
            const shape = {
                type: gameState.currentShape,
                width: width,
                height: height,
                color: gameState.currentColor,
                x: Math.random() * (gameState.canvas.width - width * 20 - 40) + 20,
                y: Math.random() * (gameState.canvas.height - height * 20 - 40) + 20,
                scale: Math.min(20, Math.max(10, 400 / Math.max(width, height)))
            };
            
            gameState.shapes.push(shape);
            drawShape(shape);
            
            // Actualizar estad√≠sticas
            const shapeData = shapeDefinitions[gameState.currentShape];
            let perimeter, area;
            
            if (shapeData.needsHeight) {
                perimeter = shapeData.perimeter(width, height);
                area = shapeData.area(width, height);
            } else {
                perimeter = shapeData.perimeter(width);
                area = shapeData.area(width);
            }
            
            gameState.stats.figuresCreated++;
            gameState.stats.totalPerimeter += perimeter;
            gameState.stats.totalArea += area;
            gameState.stats.totalScore += Math.round(perimeter + area);
            
            updateStats();
            
            // Verificar desaf√≠o
            if (gameState.mode === 'desafio' && gameState.currentChallenge) {
                checkChallengeCompletion(perimeter, area);
            }
            
            showNotification(`${shapeData.name} creado: P=${perimeter.toFixed(2)}, A=${area.toFixed(2)}`, 'success');
            
            if (gameState.soundEnabled) playSound('create');
        }

        // Dibujar forma en el canvas
        function drawShape(shape) {
            const ctx = gameState.ctx;
            ctx.fillStyle = shape.color;
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 2;
            
            ctx.save();
            ctx.translate(shape.x, shape.y);
            
            switch (shape.type) {
                case 'rectangle':
                    const rectWidth = shape.width * shape.scale;
                    const rectHeight = shape.height * shape.scale;
                    ctx.fillRect(0, 0, rectWidth, rectHeight);
                    ctx.strokeRect(0, 0, rectWidth, rectHeight);
                    
                    // Etiquetas de medidas
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '12px Arial';
                    ctx.fillText(`${shape.width}`, rectWidth/2, -10);
                    ctx.fillText(`${shape.height}`, -15, rectHeight/2);
                    break;
                    
                case 'square':
                    const squareSize = shape.width * shape.scale;
                    ctx.fillRect(0, 0, squareSize, squareSize);
                    ctx.strokeRect(0, 0, squareSize, squareSize);
                    
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '12px Arial';
                    ctx.fillText(`${shape.width}`, squareSize/2, -10);
                    break;
                    
                case 'triangle':
                    const triWidth = shape.width * shape.scale;
                    const triHeight = shape.height * shape.scale;
                    ctx.beginPath();
                    ctx.moveTo(triWidth/2, 0);
                    ctx.lineTo(0, triHeight);
                    ctx.lineTo(triWidth, triHeight);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();
                    
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '12px Arial';
                    ctx.fillText(`b=${shape.width}`, triWidth/2, triHeight + 15);
                    ctx.fillText(`h=${shape.height}`, triWidth/2 - 20, triHeight/2);
                    break;
                    
                case 'circle':
                    const radius = shape.width * shape.scale;
                    ctx.beginPath();
                    ctx.arc(radius, radius, radius, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.stroke();
                    
                    // Dibujar radio
                    ctx.strokeStyle = '#ffffff';
                    ctx.setLineDash([5, 5]);
                    ctx.beginPath();
                    ctx.moveTo(radius, radius);
                    ctx.lineTo(radius * 2, radius);
                    ctx.stroke();
                    ctx.setLineDash([]);
                    
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '12px Arial';
                    ctx.fillText(`r=${shape.width}`, radius * 1.5, radius - 10);
                    break;
            }
            
            ctx.restore();
        }

        // Redibujar canvas
        function redrawCanvas() {
            gameState.ctx.clearRect(0, 0, gameState.canvas.width, gameState.canvas.height);
            gameState.shapes.forEach(shape => drawShape(shape));
        }

        // Limpiar canvas
        function clearCanvas() {
            if (gameState.shapes.length === 0) {
                showNotification('El canvas ya est√° vac√≠o', 'info');
                return;
            }
            
            if (confirm('¬øEst√°s seguro de que quieres limpiar todas las figuras?')) {
                gameState.shapes = [];
                gameState.ctx.clearRect(0, 0, gameState.canvas.width, gameState.canvas.height);
                showNotification('Canvas limpiado', 'info');
            }
        }

        // Sistema de desaf√≠os
        const challenges = [
            {
                type: 'area',
                target: 20,
                shape: 'rectangle',
                description: 'Crea un rect√°ngulo con √°rea de 20 unidades cuadradas',
                tolerance: 0.1
            },
            {
                type: 'perimeter',
                target: 16,
                shape: 'square',
                description: 'Crea un cuadrado con per√≠metro de 16 unidades',
                tolerance: 0.1
            },
            {
                type: 'area',
                target: 12,
                shape: 'triangle',
                description: 'Crea un tri√°ngulo con √°rea de 12 unidades cuadradas',
                tolerance: 0.1
            },
            {
                type: 'area',
                target: 28.27,
                shape: 'circle',
                description: 'Crea un c√≠rculo con √°rea aproximada de 28.27 unidades cuadradas',
                tolerance: 1
            },
            {
                type: 'perimeter',
                target: 24,
                shape: 'rectangle',
                description: 'Crea un rect√°ngulo con per√≠metro de 24 unidades',
                tolerance: 0.1
            }
        ];

        function generateChallenge() {
            const challenge = challenges[Math.floor(Math.random() * challenges.length)];
            gameState.currentChallenge = { ...challenge };
            
            document.getElementById('challengeDescription').textContent = challenge.description;
            document.getElementById('challengeTarget').textContent = 
                `Meta: ${challenge.type === 'area' ? '√Årea' : 'Per√≠metro'} = ${challenge.target}`;
            document.getElementById('challengeProgress').style.width = '0%';
        }

        function checkChallengeCompletion(perimeter, area) {
            if (!gameState.currentChallenge) return;
            
            const challenge = gameState.currentChallenge;
            const currentValue = challenge.type === 'area' ? area : perimeter;
            const difference = Math.abs(currentValue - challenge.target);
            
            if (difference <= challenge.tolerance) {
                // Desaf√≠o completado
                gameState.stats.challengesCompleted++;
                gameState.stats.totalScore += 500;
                
                showAchievement('üèÜ ¬°Desaf√≠o Completado!');
                showNotification('¬°Excelente! Has completado el desaf√≠o', 'success');
                
                setTimeout(() => {
                    generateChallenge();
                }, 2000);
            } else {
                // Actualizar progreso
                const progress = Math.max(0, 100 - (difference / challenge.target) * 100);
                document.getElementById('challengeProgress').style.width = progress + '%';
                
                if (progress > 70) {
                    showNotification('¬°Muy cerca! Sigue intentando', 'info');
                }
            }
        }

        // Cambiar modo de juego
        function setGameMode(mode) {
            gameState.mode = mode;
            
            // Actualizar botones activos
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Mostrar/ocultar paneles seg√∫n el modo
            const challengePanel = document.getElementById('challengePanel');
            
            switch (mode) {
                case 'construccion':
                    challengePanel.style.display = 'none';
                    break;
                case 'desafio':
                    challengePanel.style.display = 'block';
                    generateChallenge();
                    break;
                case 'tutorial':
                    showTutorial();
                    break;
            }
            
            showNotification(`Modo cambiado a: ${mode}`, 'info');
        }

        // Sistema de tutorial
        function showTutorial() {
            document.getElementById('tutorialOverlay').style.display = 'flex';
            gameState.tutorialStep = 1;
        }

        function nextTutorialStep() {
            const currentStep = document.getElementById(`step${gameState.tutorialStep}`);
            currentStep.classList.remove('active');
            
            gameState.tutorialStep++;
            
            if (gameState.tutorialStep <= 4) {
                const nextStep = document.getElementById(`step${gameState.tutorialStep}`);
                nextStep.classList.add('active');
            } else {
                closeTutorial();
            }
        }

        function closeTutorial() {
            document.getElementById('tutorialOverlay').style.display = 'none';
            setGameMode('construccion');
        }

        // Funciones auxiliares
        function calculateAll() {
            if (gameState.shapes.length === 0) {
                showNotification('No hay figuras para calcular', 'info');
                return;
            }
            
            let totalPerimeter = 0;
            let totalArea = 0;
            
            gameState.shapes.forEach(shape => {
                const shapeData = shapeDefinitions[shape.type];
                let perimeter, area;
                
                if (shapeData.needsHeight) {
                    perimeter = shapeData.perimeter(shape.width, shape.height);
                    area = shapeData.area(shape.width, shape.height);
                } else {
                    perimeter = shapeData.perimeter(shape.width);
                    area = shapeData.area(shape.width);
                }
                
                totalPerimeter += perimeter;
                totalArea += area;
            });
            
            showNotification(`Total: P=${totalPerimeter.toFixed(2)}, A=${totalArea.toFixed(2)}`, 'success');
        }

        function showHint() {
            const hints = [
                "üí° Para calcular el √°rea de un rect√°ngulo: multiplica ancho √ó alto",
                "üí° El per√≠metro es la suma de todos los lados",
                "üí° En un cuadrado, todos los lados son iguales",
                "üí° El √°rea de un tri√°ngulo es: (base √ó altura) √∑ 2",
                "üí° En un c√≠rculo: œÄ ‚âà 3.14159",
                "üí° Usa n√∫meros peque√±os para comenzar y experimenta",
                "üí° Las f√≥rmulas aparecen en el panel izquierdo"
            ];
            
            const hint = hints[Math.floor(Math.random() * hints.length)];
            showNotification(hint, 'info');
        }

        function newChallenge() {
            generateChallenge();
            showNotification('Nuevo desaf√≠o generado', 'info');
        }

        // Eventos del canvas
        function handleCanvasClick(event) {
            // Aqu√≠ se podr√≠a implementar funcionalidad de click en el canvas
        }

        function handleCanvasMouseMove(event) {
            // Aqu√≠ se podr√≠a implementar funcionalidad de hover
        }

        // Actualizar estad√≠sticas
        function updateStats() {
            document.getElementById('figuresCreated').textContent = gameState.stats.figuresCreated;
            document.getElementById('challengesCompleted').textContent = gameState.stats.challengesCompleted;
            document.getElementById('totalPerimeter').textContent = gameState.stats.totalPerimeter.toFixed(1);
            document.getElementById('totalArea').textContent = gameState.stats.totalArea.toFixed(1);
            document.getElementById('totalScore').textContent = gameState.stats.totalScore;
        }

        // Sistema de notificaciones
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Sistema de logros
        function showAchievement(message) {
            const achievement = document.createElement('div');
            achievement.className = 'achievement';
            achievement.textContent = message;
            
            document.body.appendChild(achievement);
            
            setTimeout(() => {
                achievement.remove();
            }, 2000);
        }

        // Control de sonido
        function toggleSound() {
            gameState.soundEnabled = !gameState.soundEnabled;
            const soundToggle = document.getElementById('soundToggle');
            soundToggle.textContent = gameState.soundEnabled ? 'üîä' : 'üîá';
        }

        function playSound(type) {
            if (!gameState.soundEnabled) return;
            // En una implementaci√≥n real, aqu√≠ se reproducir√≠an sonidos
            console.log('Playing sound:', type);
        }

        // Inicializar el juego cuando se carga la p√°gina
        window.addEventListener('load', initGame);
    </script>
</body>
</html>