<!DOCTYPE html>
<html lang="es">
<head>
     <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XZ1QWD1TCC"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XZ1QWD1TCC');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Batalla de Fracciones - Grado 6¬∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .battle-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 20%, rgba(255, 107, 107, 0.3) 0%, transparent 30%),
                radial-gradient(circle at 80% 80%, rgba(72, 219, 251, 0.3) 0%, transparent 30%),
                radial-gradient(circle at 40% 60%, rgba(255, 159, 67, 0.2) 0%, transparent 40%);
            animation: battleAura 15s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes battleAura {
            0%, 100% { transform: scale(1) rotate(0deg); opacity: 0.8; }
            50% { transform: scale(1.1) rotate(2deg); opacity: 1; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 10;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .header h1 {
            font-size: 3.5rem;
            background: linear-gradient(45deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 40px rgba(255, 107, 107, 0.5);
            margin-bottom: 10px;
            animation: battleGlow 3s ease-in-out infinite;
        }

        @keyframes battleGlow {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(255, 107, 107, 0.8)); }
            33% { filter: drop-shadow(0 0 30px rgba(254, 202, 87, 0.8)); }
            66% { filter: drop-shadow(0 0 25px rgba(72, 219, 251, 0.8)); }
        }

        .subtitle {
            font-size: 1.3rem;
            color: #ddd;
            margin-bottom: 20px;
        }

        .game-mode-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .mode-btn {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.3), rgba(254, 202, 87, 0.2));
            border: 2px solid rgba(255, 107, 107, 0.4);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            box-shadow: 0 0 25px rgba(255, 107, 107, 0.6);
            transform: scale(1.05);
        }

        .mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4);
        }

        .battle-arena {
            display: grid;
            grid-template-columns: 1fr 200px 1fr;
            gap: 30px;
            margin-bottom: 30px;
            min-height: 400px;
        }

        .player-side {
            background: linear-gradient(135deg, rgba(72, 219, 251, 0.2), rgba(99, 110, 250, 0.1));
            border: 3px solid rgba(72, 219, 251, 0.4);
            border-radius: 25px;
            padding: 25px;
            position: relative;
            backdrop-filter: blur(10px);
        }

        .enemy-side {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.2), rgba(255, 159, 67, 0.1));
            border: 3px solid rgba(255, 107, 107, 0.4);
            border-radius: 25px;
            padding: 25px;
            position: relative;
            backdrop-filter: blur(10px);
        }

        .vs-section {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border-radius: 20px;
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .vs-text {
            font-size: 4rem;
            font-weight: bold;
            background: linear-gradient(45deg, #ff6b6b, #feca57, #48dbfb);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: pulse 2s ease-in-out infinite;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.5);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .side-title {
            font-size: 1.5rem;
            text-align: center;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .player-title {
            color: #48dbfb;
            text-shadow: 0 0 10px rgba(72, 219, 251, 0.8);
        }

        .enemy-title {
            color: #ff6b6b;
            text-shadow: 0 0 10px rgba(255, 107, 107, 0.8);
        }

        .character-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            position: relative;
        }

        .player-avatar {
            background: linear-gradient(135deg, #48dbfb, #0abde3);
            border: 4px solid rgba(72, 219, 251, 0.6);
            animation: heroFloat 3s ease-in-out infinite;
        }

        .enemy-avatar {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            border: 4px solid rgba(255, 107, 107, 0.6);
            animation: villainFloat 3s ease-in-out infinite reverse;
        }

        @keyframes heroFloat {
            0%, 100% { transform: translateY(0) rotate(-3deg); }
            50% { transform: translateY(-10px) rotate(3deg); }
        }

        @keyframes villainFloat {
            0%, 100% { transform: translateY(0) rotate(3deg) scaleX(-1); }
            50% { transform: translateY(-8px) rotate(-3deg) scaleX(-1); }
        }

        .health-bar {
            width: 100%;
            height: 25px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            margin-bottom: 20px;
            overflow: hidden;
            position: relative;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .health-fill {
            height: 100%;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 15px;
            position: relative;
        }

        .player-health {
            background: linear-gradient(90deg, #48dbfb, #0abde3);
            box-shadow: 0 0 15px rgba(72, 219, 251, 0.6);
        }

        .enemy-health {
            background: linear-gradient(90deg, #ff6b6b, #ee5a52);
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.6);
        }

        .health-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            color: white;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
            font-size: 0.9rem;
        }

        .fraction-display {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .fraction {
            font-size: 3rem;
            font-weight: bold;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            position: relative;
        }

        .player-fraction {
            color: #48dbfb;
            text-shadow: 0 0 15px rgba(72, 219, 251, 0.8);
        }

        .enemy-fraction {
            color: #ff6b6b;
            text-shadow: 0 0 15px rgba(255, 107, 107, 0.8);
        }

        .fraction-line {
            width: 80%;
            height: 4px;
            background: currentColor;
            margin: 5px auto;
            border-radius: 2px;
        }

        .battle-question {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05));
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 25px;
            margin: 25px 0;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .question-title {
            font-size: 1.5rem;
            color: #feca57;
            margin-bottom: 15px;
            text-shadow: 0 0 10px rgba(254, 202, 87, 0.8);
        }

        .question-text {
            font-size: 1.2rem;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .answer-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .answer-btn {
            background: linear-gradient(135deg, #636e72, #2d3436);
            color: white;
            border: 3px solid rgba(255, 255, 255, 0.2);
            padding: 18px;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .answer-btn:hover {
            transform: translateY(-3px);
            border-color: rgba(254, 202, 87, 0.6);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .answer-btn.correct {
            background: linear-gradient(135deg, #00b894, #00cec9);
            border-color: #00b894;
            animation: correctPulse 1s ease;
        }

        .answer-btn.wrong {
            background: linear-gradient(135deg, #e17055, #d63031);
            border-color: #e17055;
            animation: wrongShake 0.5s ease;
        }

        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); box-shadow: 0 0 30px rgba(0, 184, 148, 0.8); }
            100% { transform: scale(1); }
        }

        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: rgba(254, 202, 87, 0.6);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: block;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #feca57;
            margin-bottom: 5px;
            text-shadow: 0 0 10px rgba(254, 202, 87, 0.6);
        }

        .stat-label {
            color: #ddd;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .battle-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 25px 0;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, #6c5ce7, #a29bfe);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            min-width: 150px;
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(108, 92, 231, 0.4);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn-primary {
            background: linear-gradient(135deg, #48dbfb, #0abde3);
        }

        .btn-primary:hover {
            box-shadow: 0 12px 30px rgba(72, 219, 251, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #feca57, #ff9ff3);
        }

        .btn-secondary:hover {
            box-shadow: 0 12px 30px rgba(254, 202, 87, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
        }

        .btn-danger:hover {
            box-shadow: 0 12px 30px rgba(255, 107, 107, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .timer-display {
            font-size: 1.8rem;
            font-weight: bold;
            color: #feca57;
            text-align: center;
            margin: 15px 0;
            text-shadow: 0 0 15px rgba(254, 202, 87, 0.8);
        }

        .combo-counter {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ff9ff3, #feca57);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.1rem;
            box-shadow: 0 5px 15px rgba(255, 159, 243, 0.4);
            animation: comboGlow 2s ease-in-out infinite;
        }

        @keyframes comboGlow {
            0%, 100% { box-shadow: 0 5px 15px rgba(255, 159, 243, 0.4); }
            50% { box-shadow: 0 5px 25px rgba(255, 159, 243, 0.8); }
        }

        .battle-result {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s ease;
        }

        .battle-result.show {
            opacity: 1;
            visibility: visible;
        }

        .result-content {
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 50px;
            border-radius: 25px;
            text-align: center;
            transform: scale(0.8);
            transition: transform 0.5s ease;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.5);
            max-width: 500px;
            border: 3px solid rgba(255, 255, 255, 0.3);
        }

        .battle-result.show .result-content {
            transform: scale(1);
        }

        .result-title {
            font-size: 3rem;
            margin-bottom: 20px;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.8);
        }

        .result-stats {
            margin: 25px 0;
            font-size: 1.2rem;
            line-height: 1.8;
        }

        .fraction-visual {
            display: inline-block;
            vertical-align: middle;
            text-align: center;
            margin: 0 10px;
        }

        .fraction-numerator, .fraction-denominator {
            display: block;
            line-height: 1;
        }

        .fraction-numerator {
            border-bottom: 2px solid currentColor;
            padding-bottom: 2px;
        }

        .power-up {
            position: absolute;
            background: linear-gradient(135deg, #feca57, #ff9ff3);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            animation: powerUpFloat 3s ease-in-out infinite;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        @keyframes powerUpFloat {
            0%, 100% { transform: translateY(0) rotate(-2deg); }
            50% { transform: translateY(-15px) rotate(2deg); }
        }

        .power-up:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(254, 202, 87, 0.6);
        }

        .visual-fraction {
            margin: 20px 0;
        }

        .fraction-bar {
            width: 100%;
            height: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            margin: 10px 0;
            overflow: hidden;
            position: relative;
        }

        .fraction-fill {
            height: 100%;
            background: linear-gradient(90deg, #48dbfb, #0abde3);
            border-radius: 15px;
            transition: width 1s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .alert {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 30px;
            border-radius: 12px;
            font-weight: bold;
            z-index: 1001;
            animation: alertSlide 0.5s ease;
            max-width: 400px;
        }

        @keyframes alertSlide {
            from { opacity: 0; transform: translateX(-50%) translateY(-20px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        .alert-success {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
        }

        .alert-error {
            background: linear-gradient(135deg, #e17055, #d63031);
            color: white;
        }

        .alert-info {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
        }

        .sound-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #6c5ce7, #a29bfe);
            border: none;
            color: white;
            padding: 15px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 1001;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .sound-toggle:hover {
            transform: scale(1.1);
        }

        .explanation-panel {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.4));
            border: 2px solid rgba(254, 202, 87, 0.4);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            display: none;
            animation: slideDown 0.5s ease;
        }

        .explanation-panel.show {
            display: block;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .step-by-step {
            margin: 15px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border-left: 4px solid #48dbfb;
        }

        @media (max-width: 768px) {
            .battle-arena {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .vs-section {
                order: -1;
            }

            .header h1 {
                font-size: 2.5rem;
            }

            .answer-options {
                grid-template-columns: 1fr;
            }

            .battle-controls {
                flex-direction: column;
                align-items: center;
            }

            .stats-panel {
                grid-template-columns: repeat(2, 1fr);
            }

            .fraction {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="battle-background"></div>
    
    <button class="sound-toggle" onclick="toggleSound()" id="soundToggle">üîä</button>
    
    <div class="container">
        <div class="header">
            <h1>‚öîÔ∏è BATALLA DE FRACCIONES</h1>
            <p class="subtitle">¬°Demuestra tu dominio de las fracciones en combate √©pico!</p>
            
            <div class="game-mode-selector">
                <button class="mode-btn active" onclick="setGameMode('comparacion')">üéØ Comparaci√≥n</button>
                <button class="mode-btn" onclick="setGameMode('suma')">‚ûï Suma</button>
                <button class="mode-btn" onclick="setGameMode('resta')">‚ûñ Resta</button>
                <button class="mode-btn" onclick="setGameMode('multiplicacion')">‚úñÔ∏è Multiplicaci√≥n</button>
                <button class="mode-btn" onclick="setGameMode('division')">‚ûó Divisi√≥n</button>
            </div>

            <div class="timer-display" id="timerDisplay">‚è±Ô∏è 00:00</div>
        </div>

        <!-- Panel de Estad√≠sticas -->
        <div class="stats-panel">
            <div class="stat-card">
                <span class="stat-icon">üèÜ</span>
                <div class="stat-value" id="wins">0</div>
                <div class="stat-label">Victorias</div>
            </div>
            <div class="stat-card">
                <span class="stat-icon">‚ö°</span>
                <div class="stat-value" id="streak">0</div>
                <div class="stat-label">Racha</div>
            </div>
            <div class="stat-card">
                <span class="stat-icon">üéØ</span>
                <div class="stat-value" id="accuracy">0%</div>
                <div class="stat-label">Precisi√≥n</div>
            </div>
            <div class="stat-card">
                <span class="stat-icon">‚≠ê</span>
                <div class="stat-value" id="score">0</div>
                <div class="stat-label">Puntuaci√≥n</div>
            </div>
        </div>

        <!-- Arena de Batalla -->
        <div class="battle-arena">
            <!-- Lado del Jugador -->
            <div class="player-side">
                <div class="combo-counter" id="comboCounter">COMBO: 0</div>
                <h3 class="side-title player-title">üõ°Ô∏è TU H√âROE</h3>
                
                <div class="character-avatar player-avatar">ü¶∏‚Äç‚ôÇÔ∏è</div>
                
                <div class="health-bar">
                    <div class="health-fill player-health" id="playerHealth" style="width: 100%;">
                        <div class="health-text">100 HP</div>
                    </div>
                </div>

                <div class="fraction-display">
                    <div class="visual-fraction">
                        <div class="fraction-bar">
                            <div class="fraction-fill" id="playerFractionBar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="fraction player-fraction" id="playerFraction">
                        <div class="fraction-numerator">1</div>
                        <div class="fraction-line"></div>
                        <div class="fraction-denominator">2</div>
                    </div>
                </div>
            </div>

            <!-- Secci√≥n VS -->
            <div class="vs-section">
                <div class="vs-text">VS</div>
                <div style="margin-top: 20px;">
                    <div class="power-up" style="position: relative;" onclick="usePowerUp('hint')">
                        üí° PISTA
                    </div>
                    <div class="power-up" style="position: relative; margin-top: 15px;" onclick="usePowerUp('time')">
                        ‚è∞ +TIEMPO
                    </div>
                </div>
            </div>

            <!-- Lado del Enemigo -->
            <div class="enemy-side">
                <h3 class="side-title enemy-title">üëπ VILLANO</h3>
                
                <div class="character-avatar enemy-avatar">ü¶π‚Äç‚ôÇÔ∏è</div>
                
                <div class="health-bar">
                    <div class="health-fill enemy-health" id="enemyHealth" style="width: 100%;">
                        <div class="health-text">100 HP</div>
                    </div>
                </div>

                <div class="fraction-display">
                    <div class="visual-fraction">
                        <div class="fraction-bar">
                            <div class="fraction-fill" id="enemyFractionBar" style="width: 0%; background: linear-gradient(90deg, #ff6b6b, #ee5a52);"></div>
                        </div>
                    </div>
                    <div class="fraction enemy-fraction" id="enemyFraction">
                        <div class="fraction-numerator">3</div>
                        <div class="fraction-line"></div>
                        <div class="fraction-denominator">4</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pregunta de Batalla -->
        <div class="battle-question" id="battleQuestion">
            <div class="question-title">‚öîÔ∏è DESAF√çO MATEM√ÅTICO</div>
            <div class="question-text" id="questionText">¬øCu√°l fracci√≥n es mayor?</div>
            
            <div class="answer-options" id="answerOptions">
                <button class="answer-btn" onclick="selectAnswer(0)">1/2</button>
                <button class="answer-btn" onclick="selectAnswer(1)">3/4</button>
                <button class="answer-btn" onclick="selectAnswer(2)">Son iguales</button>
                <button class="answer-btn" onclick="selectAnswer(3)">No se puede determinar</button>
            </div>

            <div class="explanation-panel" id="explanationPanel">
                <h4>üìö Explicaci√≥n paso a paso:</h4>
                <div class="step-by-step" id="stepByStep">
                    Para comparar fracciones, necesitamos encontrar un denominador com√∫n...
                </div>
            </div>
        </div>

        <!-- Controles de Batalla -->
        <div class="battle-controls">
            <button class="btn btn-primary" onclick="newBattle()">‚öîÔ∏è Nueva Batalla</button>
            <button class="btn btn-secondary" onclick="showExplanation()">üìñ Explicaci√≥n</button>
            <button class="btn btn-danger" onclick="resetGame()">üîÑ Reiniciar</button>
        </div>
    </div>

    <!-- Modal de Resultado -->
    <div class="battle-result" id="battleResult">
        <div class="result-content">
            <div class="result-title" id="resultTitle">üèÜ ¬°VICTORIA!</div>
            <div class="result-stats" id="resultStats">
                <p>Tiempo: <span id="finalTime">00:00</span></p>
                <p>Precisi√≥n: <span id="finalAccuracy">100%</span></p>
                <p>Puntuaci√≥n: <span id="finalScore">1000</span></p>
            </div>
            <div class="battle-controls">
                <button class="btn btn-primary" onclick="closeBattleResult()">Continuar</button>
                <button class="btn btn-secondary" onclick="newBattle()">Nueva Batalla</button>
            </div>
        </div>
    </div>

    <script>
         // Redirige si no hay usuario autenticado
        if (!localStorage.getItem('currentUser') && !sessionStorage.getItem('currentUser')) {
            window.location.href = "complete-login-html.html";
        }
        // Variables globales del juego
        let gameState = {
            mode: 'comparacion',
            playerHealth: 100,
            enemyHealth: 100,
            score: 0,
            wins: 0,
            totalQuestions: 0,
            correctAnswers: 0,
            currentStreak: 0,
            combo: 0,
            timeElapsed: 0,
            gameTimer: null,
            soundEnabled: true,
            powerUps: {
                hints: 3,
                timeBonus: 2
            },
            currentQuestion: null,
            difficulty: 1
        };

        // Inicializar el juego
        function initGame() {
            updateStats();
            newBattle();
            startTimer();
        }

        // Gesti√≥n del temporizador
        function startTimer() {
            gameState.gameTimer = setInterval(() => {
                gameState.timeElapsed++;
                updateTimerDisplay();
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(gameState.timeElapsed / 60);
            const seconds = gameState.timeElapsed % 60;
            document.getElementById('timerDisplay').textContent = 
                `‚è±Ô∏è ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Generadores de fracciones
        function generateFraction(difficulty = 1) {
            const maxNum = difficulty <= 2 ? 12 : 20;
            const maxDen = difficulty <= 2 ? 12 : 20;
            
            let numerator, denominator;
            do {
                numerator = Math.floor(Math.random() * maxNum) + 1;
                denominator = Math.floor(Math.random() * maxDen) + 2;
            } while (numerator >= denominator && Math.random() > 0.3); // Prefiere fracciones propias
            
            return { numerator, denominator };
        }

        function simplifyFraction(numerator, denominator) {
            const gcd = (a, b) => b === 0 ? a : gcd(b, a % b);
            const commonDivisor = gcd(numerator, denominator);
            return {
                numerator: numerator / commonDivisor,
                denominator: denominator / commonDivisor
            };
        }

        function fractionToDecimal(fraction) {
            return fraction.numerator / fraction.denominator;
        }

        // Generadores de preguntas por modo
        function generateComparisonQuestion() {
            const fraction1 = generateFraction(gameState.difficulty);
            const fraction2 = generateFraction(gameState.difficulty);
            
            const value1 = fractionToDecimal(fraction1);
            const value2 = fractionToDecimal(fraction2);
            
            let correctAnswer, options;
            
            if (Math.abs(value1 - value2) < 0.01) {
                correctAnswer = 2; // Son iguales
                options = [
                    `${fraction1.numerator}/${fraction1.denominator}`,
                    `${fraction2.numerator}/${fraction2.denominator}`,
                    "Son iguales",
                    "No se puede determinar"
                ];
            } else if (value1 > value2) {
                correctAnswer = 0;
                options = [
                    `${fraction1.numerator}/${fraction1.denominator}`,
                    `${fraction2.numerator}/${fraction2.denominator}`,
                    "Son iguales",
                    "No se puede determinar"
                ];
            } else {
                correctAnswer = 1;
                options = [
                    `${fraction1.numerator}/${fraction1.denominator}`,
                    `${fraction2.numerator}/${fraction2.denominator}`,
                    "Son iguales",
                    "No se puede determinar"
                ];
            }
            
            return {
                question: "¬øCu√°l fracci√≥n es mayor?",
                playerFraction: fraction1,
                enemyFraction: fraction2,
                options,
                correctAnswer,
                explanation: generateComparisonExplanation(fraction1, fraction2)
            };
        }

        function generateSumQuestion() {
            const fraction1 = generateFraction(gameState.difficulty);
            const fraction2 = generateFraction(gameState.difficulty);
            
            // Calcular la suma
            const commonDen = fraction1.denominator * fraction2.denominator;
            const sumNum = (fraction1.numerator * fraction2.denominator) + (fraction2.numerator * fraction1.denominator);
            const result = simplifyFraction(sumNum, commonDen);
            
            // Generar opciones incorrectas
            const options = [
                `${result.numerator}/${result.denominator}`,
                `${result.numerator + 1}/${result.denominator}`,
                `${fraction1.numerator + fraction2.numerator}/${fraction1.denominator + fraction2.denominator}`,
                `${result.numerator}/${result.denominator + 1}`
            ];
            
            // Mezclar opciones
            const correctAnswer = 0;
            shuffleArray(options);
            const newCorrectIndex = options.indexOf(`${result.numerator}/${result.denominator}`);
            
            return {
                question: `¬øCu√°l es el resultado de ${fraction1.numerator}/${fraction1.denominator} + ${fraction2.numerator}/${fraction2.denominator}?`,
                playerFraction: fraction1,
                enemyFraction: fraction2,
                options,
                correctAnswer: newCorrectIndex,
                explanation: generateSumExplanation(fraction1, fraction2, result)
            };
        }

        function generateSubtractionQuestion() {
            let fraction1 = generateFraction(gameState.difficulty);
            let fraction2 = generateFraction(gameState.difficulty);
            
            // Asegurar que fraction1 > fraction2 para resultado positivo
            if (fractionToDecimal(fraction1) < fractionToDecimal(fraction2)) {
                [fraction1, fraction2] = [fraction2, fraction1];
            }
            
            const commonDen = fraction1.denominator * fraction2.denominator;
            const diffNum = (fraction1.numerator * fraction2.denominator) - (fraction2.numerator * fraction1.denominator);
            const result = simplifyFraction(diffNum, commonDen);
            
            const options = [
                `${result.numerator}/${result.denominator}`,
                `${result.numerator + 1}/${result.denominator}`,
                `${Math.abs(fraction1.numerator - fraction2.numerator)}/${Math.abs(fraction1.denominator - fraction2.denominator)}`,
                `${result.numerator}/${result.denominator + 1}`
            ];
            
            shuffleArray(options);
            const newCorrectIndex = options.indexOf(`${result.numerator}/${result.denominator}`);
            
            return {
                question: `¬øCu√°l es el resultado de ${fraction1.numerator}/${fraction1.denominator} - ${fraction2.numerator}/${fraction2.denominator}?`,
                playerFraction: fraction1,
                enemyFraction: fraction2,
                options,
                correctAnswer: newCorrectIndex,
                explanation: generateSubtractionExplanation(fraction1, fraction2, result)
            };
        }

        function generateMultiplicationQuestion() {
            const fraction1 = generateFraction(gameState.difficulty);
            const fraction2 = generateFraction(gameState.difficulty);
            
            const resultNum = fraction1.numerator * fraction2.numerator;
            const resultDen = fraction1.denominator * fraction2.denominator;
            const result = simplifyFraction(resultNum, resultDen);
            
            const options = [
                `${result.numerator}/${result.denominator}`,
                `${resultNum}/${resultDen}`, // Sin simplificar
                `${fraction1.numerator * fraction2.numerator}/${fraction1.denominator + fraction2.denominator}`,
                `${fraction1.numerator + fraction2.numerator}/${fraction1.denominator * fraction2.denominator}`
            ];
            
            shuffleArray(options);
            const newCorrectIndex = options.indexOf(`${result.numerator}/${result.denominator}`);
            
            return {
                question: `¬øCu√°l es el resultado de ${fraction1.numerator}/${fraction1.denominator} √ó ${fraction2.numerator}/${fraction2.denominator}?`,
                playerFraction: fraction1,
                enemyFraction: fraction2,
                options,
                correctAnswer: newCorrectIndex,
                explanation: generateMultiplicationExplanation(fraction1, fraction2, result)
            };
        }

        function generateDivisionQuestion() {
            const fraction1 = generateFraction(gameState.difficulty);
            const fraction2 = generateFraction(gameState.difficulty);
            
            const resultNum = fraction1.numerator * fraction2.denominator;
            const resultDen = fraction1.denominator * fraction2.numerator;
            const result = simplifyFraction(resultNum, resultDen);
            
            const options = [
                `${result.numerator}/${result.denominator}`,
                `${fraction1.numerator * fraction2.numerator}/${fraction1.denominator * fraction2.denominator}`,
                `${resultNum}/${resultDen}`, // Sin simplificar
                `${fraction1.numerator}/${fraction2.numerator}`
            ];
            
            shuffleArray(options);
            const newCorrectIndex = options.indexOf(`${result.numerator}/${result.denominator}`);
            
            return {
                question: `¬øCu√°l es el resultado de ${fraction1.numerator}/${fraction1.denominator} √∑ ${fraction2.numerator}/${fraction2.denominator}?`,
                playerFraction: fraction1,
                enemyFraction: fraction2,
                options,
                correctAnswer: newCorrectIndex,
                explanation: generateDivisionExplanation(fraction1, fraction2, result)
            };
        }

        // Generar explicaciones
        function generateComparisonExplanation(f1, f2) {
            const commonDen = f1.denominator * f2.denominator;
            const num1 = f1.numerator * f2.denominator;
            const num2 = f2.numerator * f1.denominator;
            
            return `Para comparar ${f1.numerator}/${f1.denominator} y ${f2.numerator}/${f2.denominator}:
                    <br>1. Encontramos denominador com√∫n: ${commonDen}
                    <br>2. ${f1.numerator}/${f1.denominator} = ${num1}/${commonDen}
                    <br>3. ${f2.numerator}/${f2.denominator} = ${num2}/${commonDen}
                    <br>4. Como ${num1} ${num1 > num2 ? '>' : num1 < num2 ? '<' : '='} ${num2}, entonces ${f1.numerator}/${f1.denominator} ${num1 > num2 ? '>' : num1 < num2 ? '<' : '='} ${f2.numerator}/${f2.denominator}`;
        }

        function generateSumExplanation(f1, f2, result) {
            const commonDen = f1.denominator * f2.denominator;
            const num1 = f1.numerator * f2.denominator;
            const num2 = f2.numerator * f1.denominator;
            
            return `Para sumar ${f1.numerator}/${f1.denominator} + ${f2.numerator}/${f2.denominator}:
                    <br>1. Denominador com√∫n: ${commonDen}
                    <br>2. ${f1.numerator}/${f1.denominator} = ${num1}/${commonDen}
                    <br>3. ${f2.numerator}/${f2.denominator} = ${num2}/${commonDen}
                    <br>4. ${num1}/${commonDen} + ${num2}/${commonDen} = ${num1 + num2}/${commonDen}
                    <br>5. Simplificando: ${result.numerator}/${result.denominator}`;
        }

        function generateSubtractionExplanation(f1, f2, result) {
            const commonDen = f1.denominator * f2.denominator;
            const num1 = f1.numerator * f2.denominator;
            const num2 = f2.numerator * f1.denominator;
            
            return `Para restar ${f1.numerator}/${f1.denominator} - ${f2.numerator}/${f2.denominator}:
                    <br>1. Denominador com√∫n: ${commonDen}
                    <br>2. ${f1.numerator}/${f1.denominator} = ${num1}/${commonDen}
                    <br>3. ${f2.numerator}/${f2.denominator} = ${num2}/${commonDen}
                    <br>4. ${num1}/${commonDen} - ${num2}/${commonDen} = ${num1 - num2}/${commonDen}
                    <br>5. Simplificando: ${result.numerator}/${result.denominator}`;
        }

        function generateMultiplicationExplanation(f1, f2, result) {
            return `Para multiplicar ${f1.numerator}/${f1.denominator} √ó ${f2.numerator}/${f2.denominator}:
                    <br>1. Multiplicamos numeradores: ${f1.numerator} √ó ${f2.numerator} = ${f1.numerator * f2.numerator}
                    <br>2. Multiplicamos denominadores: ${f1.denominator} √ó ${f2.denominator} = ${f1.denominator * f2.denominator}
                    <br>3. Resultado: ${f1.numerator * f2.numerator}/${f1.denominator * f2.denominator}
                    <br>4. Simplificando: ${result.numerator}/${result.denominator}`;
        }

        function generateDivisionExplanation(f1, f2, result) {
            return `Para dividir ${f1.numerator}/${f1.denominator} √∑ ${f2.numerator}/${f2.denominator}:
                    <br>1. Invertimos la segunda fracci√≥n: ${f2.denominator}/${f2.numerator}
                    <br>2. Multiplicamos: ${f1.numerator}/${f1.denominator} √ó ${f2.denominator}/${f2.numerator}
                    <br>3. ${f1.numerator} √ó ${f2.denominator} = ${f1.numerator * f2.denominator}
                    <br>4. ${f1.denominator} √ó ${f2.numerator} = ${f1.denominator * f2.numerator}
                    <br>5. Resultado: ${result.numerator}/${result.denominator}`;
        }

        // Funciones utilitarias
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Cambiar modo de juego
        function setGameMode(mode) {
            gameState.mode = mode;
            
            // Actualizar botones activos
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Generar nueva pregunta
            newBattle();
            
            showAlert(`Modo cambiado a: ${mode}`, 'info');
        }

        // Nueva batalla
        function newBattle() {
            // Incrementar dificultad cada 5 preguntas correctas
            gameState.difficulty = Math.floor(gameState.correctAnswers / 5) + 1;
            
            let question;
            switch (gameState.mode) {
                case 'comparacion':
                    question = generateComparisonQuestion();
                    break;
                case 'suma':
                    question = generateSumQuestion();
                    break;
                case 'resta':
                    question = generateSubtractionQuestion();
                    break;
                case 'multiplicacion':
                    question = generateMultiplicationQuestion();
                    break;
                case 'division':
                    question = generateDivisionQuestion();
                    break;
                default:
                    question = generateComparisonQuestion();
            }
            
            gameState.currentQuestion = question;
            displayQuestion(question);
            updateFractionDisplays(question.playerFraction, question.enemyFraction);
        }

        // Mostrar pregunta
        function displayQuestion(question) {
            document.getElementById('questionText').innerHTML = question.question;
            
            const optionsContainer = document.getElementById('answerOptions');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'answer-btn';
                button.textContent = option;
                button.onclick = () => selectAnswer(index);
                optionsContainer.appendChild(button);
            });
            
            // Ocultar explicaci√≥n
            document.getElementById('explanationPanel').classList.remove('show');
        }

        // Actualizar displays de fracciones
        function updateFractionDisplays(playerFraction, enemyFraction) {
            // Actualizar fracci√≥n del jugador
            document.querySelector('#playerFraction .fraction-numerator').textContent = playerFraction.numerator;
            document.querySelector('#playerFraction .fraction-denominator').textContent = playerFraction.denominator;
            
            // Actualizar fracci√≥n del enemigo
            document.querySelector('#enemyFraction .fraction-numerator').textContent = enemyFraction.numerator;
            document.querySelector('#enemyFraction .fraction-denominator').textContent = enemyFraction.denominator;
            
            // Actualizar barras visuales
            const playerPercent = Math.min(100, (playerFraction.numerator / playerFraction.denominator) * 100);
            const enemyPercent = Math.min(100, (enemyFraction.numerator / enemyFraction.denominator) * 100);
            
            document.getElementById('playerFractionBar').style.width = playerPercent + '%';
            document.getElementById('enemyFractionBar').style.width = enemyPercent + '%';
        }

        // Seleccionar respuesta
        function selectAnswer(selectedIndex) {
            const buttons = document.querySelectorAll('.answer-btn');
            const isCorrect = selectedIndex === gameState.currentQuestion.correctAnswer;
            
            gameState.totalQuestions++;
            
            if (isCorrect) {
                buttons[selectedIndex].classList.add('correct');
                gameState.correctAnswers++;
                gameState.currentStreak++;
                gameState.combo++;
                
                // Da√±o al enemigo
                damageEnemy();
                
                // Puntuaci√≥n con bonus por combo
                const baseScore = 100;
                const comboBonus = gameState.combo * 10;
                const timeBonus = Math.max(0, 30 - (gameState.timeElapsed % 60));
                gameState.score += baseScore + comboBonus + timeBonus;
                
                showAlert('¬°Correcto! +' + (baseScore + comboBonus + timeBonus) + ' puntos', 'success');
                
                if (gameState.soundEnabled) playSound('correct');
            } else {
                buttons[selectedIndex].classList.add('wrong');
                buttons[gameState.currentQuestion.correctAnswer].classList.add('correct');
                
                gameState.currentStreak = 0;
                gameState.combo = 0;
                
                // Da√±o al jugador
                damagePlayer();
                
                showAlert('Incorrecto. La respuesta correcta es: ' + 
                         gameState.currentQuestion.options[gameState.currentQuestion.correctAnswer], 'error');
                
                if (gameState.soundEnabled) playSound('wrong');
            }
            
            // Deshabilitar botones
            buttons.forEach(btn => btn.disabled = true);
            
            updateStats();
            
            // Generar nueva pregunta despu√©s de un delay
            setTimeout(() => {
                if (gameState.playerHealth <= 0) {
                    showBattleResult(false);
                } else if (gameState.enemyHealth <= 0) {
                    showBattleResult(true);
                } else {
                    newBattle();
                }
            }, 2000);
        }

        // Sistema de da√±o
        function damagePlayer() {
            gameState.playerHealth = Math.max(0, gameState.playerHealth - 20);
            updateHealthBar('player', gameState.playerHealth);
        }

        function damageEnemy() {
            const damage = 15 + (gameState.combo * 2);
            gameState.enemyHealth = Math.max(0, gameState.enemyHealth - damage);
            updateHealthBar('enemy', gameState.enemyHealth);
        }

        function updateHealthBar(type, health) {
            const healthBar = document.getElementById(type + 'Health');
            const healthText = healthBar.querySelector('.health-text');
            
            healthBar.style.width = health + '%';
            healthText.textContent = health + ' HP';
        }

        // Actualizar estad√≠sticas
        function updateStats() {
            document.getElementById('wins').textContent = gameState.wins;
            document.getElementById('streak').textContent = gameState.currentStreak;
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('comboCounter').textContent = 'COMBO: ' + gameState.combo;
            
            const accuracy = gameState.totalQuestions > 0 ? 
                Math.round((gameState.correctAnswers / gameState.totalQuestions) * 100) : 0;
            document.getElementById('accuracy').textContent = accuracy + '%';
        }

        // Mostrar resultado de batalla
        function showBattleResult(won) {
            if (won) {
                gameState.wins++;
                gameState.enemyHealth = 100; // Resetear para pr√≥xima batalla
            } else {
                gameState.playerHealth = 100; // Resetear para pr√≥xima batalla
            }
            
            const resultModal = document.getElementById('battleResult');
            const resultTitle = document.getElementById('resultTitle');
            const finalTime = document.getElementById('finalTime');
            const finalAccuracy = document.getElementById('finalAccuracy');
            const finalScore = document.getElementById('finalScore');
            
            resultTitle.textContent = won ? 'üèÜ ¬°VICTORIA!' : 'üíÄ DERROTA';
            
            const minutes = Math.floor(gameState.timeElapsed / 60);
            const seconds = gameState.timeElapsed % 60;
            finalTime.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            const accuracy = gameState.totalQuestions > 0 ? 
                Math.round((gameState.correctAnswers / gameState.totalQuestions) * 100) : 0;
            finalAccuracy.textContent = accuracy + '%';
            finalScore.textContent = gameState.score;
            
            resultModal.classList.add('show');
            
            // Resetear salud
            gameState.playerHealth = 100;
            gameState.enemyHealth = 100;
            updateHealthBar('player', 100);
            updateHealthBar('enemy', 100);
        }

        function closeBattleResult() {
            document.getElementById('battleResult').classList.remove('show');
        }

        // Power-ups
        function usePowerUp(type) {
            if (type === 'hint' && gameState.powerUps.hints > 0) {
                gameState.powerUps.hints--;
                showExplanation();
                showAlert('üí° Pista utilizada! Te quedan ' + gameState.powerUps.hints, 'info');
            } else if (type === 'time' && gameState.powerUps.timeBonus > 0) {
                gameState.powerUps.timeBonus--;
                gameState.timeElapsed = Math.max(0, gameState.timeElapsed - 30);
                updateTimerDisplay();
                showAlert('‚è∞ ¬°30 segundos a√±adidos! Te quedan ' + gameState.powerUps.timeBonus, 'info');
            } else {
                showAlert('‚ùå No tienes m√°s power-ups de este tipo', 'error');
            }
        }

        // Mostrar explicaci√≥n
        function showExplanation() {
            if (gameState.currentQuestion) {
                const panel = document.getElementById('explanationPanel');
                const stepByStep = document.getElementById('stepByStep');
                
                stepByStep.innerHTML = gameState.currentQuestion.explanation;
                panel.classList.add('show');
            }
        }

        // Funciones de control
        function resetGame() {
            if (confirm('¬øEst√°s seguro de que quieres reiniciar el juego?')) {
                gameState = {
                    mode: 'comparacion',
                    playerHealth: 100,
                    enemyHealth: 100,
                    score: 0,
                    wins: 0,
                    totalQuestions: 0,
                    correctAnswers: 0,
                    currentStreak: 0,
                    combo: 0,
                    timeElapsed: 0,
                    gameTimer: gameState.gameTimer,
                    soundEnabled: gameState.soundEnabled,
                    powerUps: {
                        hints: 3,
                        timeBonus: 2
                    },
                    currentQuestion: null,
                    difficulty: 1
                };
                
                updateStats();
                updateHealthBar('player', 100);
                updateHealthBar('enemy', 100);
                newBattle();
                showAlert('üîÑ Juego reiniciado', 'info');
            }
        }

        function toggleSound() {
            gameState.soundEnabled = !gameState.soundEnabled;
            const soundToggle = document.getElementById('soundToggle');
            soundToggle.textContent = gameState.soundEnabled ? 'üîä' : 'üîá';
        }

        // Funciones de sonido (simuladas)
        function playSound(type) {
            if (!gameState.soundEnabled) return;
            
            // En una implementaci√≥n real, aqu√≠ se reproducir√≠an sonidos
            console.log('Playing sound:', type);
        }

        // Sistema de alertas
        function showAlert(message, type) {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            
            document.body.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 3000);
        }

        // Inicializar el juego cuando se carga la p√°gina
        window.addEventListener('load', initGame);
    </script>
</body>
</html>